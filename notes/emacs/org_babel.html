<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Org Babel</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/main.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id="navbar" class="cf">
  <ul class="cf">
    <li class="fl">
      <a href="/">cfclrk</a>
    </li>
    <li class="fr">
      <a href="/articles/home.html">Articles</a>
    </li>
    <li class="fr">
      <a href="/notes/home.html">Notes</a>
    </li>
	<li class="fr">
      <a href="/cloudformation/home.html">CloudFormation</a>
    </li>
  </ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Org Babel</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org71aeb88">Print Error of Code Block</a>
<ul>
<li><a href="#orgfd29fe2">Shell</a></li>
<li><a href="#orgeedffbf">Python</a></li>
</ul>
</li>
<li><a href="#org865ede8">Emacs Lisp</a></li>
<li><a href="#org3fde9e0">TRAMP</a>
<ul>
<li><a href="#orge5a6057">Single Hop</a></li>
<li><a href="#org889495f">Double-Hop (Use a Bastion)</a></li>
</ul>
</li>
<li><a href="#orga58983f">Copy File to Remote Machine</a></li>
<li><a href="#org0590eff">IP Address Variable</a></li>
</ul>
</div>
</nav>

<div id="outline-container-org71aeb88" class="outline-2">
<h2 id="org71aeb88"><a href="#org71aeb88">Print Error of Code Block</a></h2>
<div class="outline-text-2" id="text-org71aeb88">
<p>
Relevant SO questions:
</p>

<ul class="org-ul">
<li><a href="https://emacs.stackexchange.com/questions/60649/show-compilation-errors-in-results-code-blocks">Show compilation errors in “#+RESULTS” code blocks</a></li>
<li><a href="https://emacs.stackexchange.com/questions/48835/help-me-avoid-true-in-org-babel-bash-statements/48842#48842">Help me avoid “|| true” in org babel bash statements</a></li>
</ul>
</div>

<div id="outline-container-orgfd29fe2" class="outline-3">
<h3 id="orgfd29fe2"><a href="#orgfd29fe2">Shell</a></h3>
<div class="outline-text-3" id="text-orgfd29fe2">
<div class="org-src-container">
<pre class="src src-bash">ls --foo
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
ls: illegal option -- -
usage: ls [-@ABCFGHLOPRSTUWabcdefghiklmnopqrstuwx1%] [file ...]
</pre>


<p>
Doesn't work:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"hi"</span>
<span style="color: #51afef;">exit</span> 1
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c678dd;">set</span> -u
<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">foo</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeedffbf" class="outline-3">
<h3 id="orgeedffbf"><a href="#orgeedffbf">Python</a></h3>
<div class="outline-text-3" id="text-orgeedffbf">
<div class="org-src-container">
<pre class="src src-sh">python -c <span style="color: #98be65;">'bar=b"&#1054;&#1060;&#1048;&#1057;"''</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org865ede8" class="outline-2">
<h2 id="org865ede8"><a href="#org865ede8">Emacs Lisp</a></h2>
<div class="outline-text-2" id="text-org865ede8">
<p>
To print data structure, use <code>:results value pp</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0a3a2ad">'<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"DeploymentName"</span> <span style="color: #98be65;">"webserver"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"KeyName"</span> <span style="color: #98be65;">"cfc"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">Params
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
(("DeploymentName" "webserver")
 ("KeyName" "cfc"))
</pre>
</div>
</div>

<div id="outline-container-org3fde9e0" class="outline-2">
<h2 id="org3fde9e0"><a href="#org3fde9e0">TRAMP</a></h2>
<div class="outline-text-2" id="text-org3fde9e0">
</div>
<div id="outline-container-orge5a6057" class="outline-3">
<h3 id="orge5a6057"><a href="#orge5a6057">Single Hop</a></h3>
<div class="outline-text-3" id="text-orge5a6057">
<pre class="example" id="orgdf0f256">
:dir /ssh:ec2-user@1.2.3.4:/
</pre>
</div>
</div>

<div id="outline-container-org889495f" class="outline-3">
<h3 id="org889495f"><a href="#org889495f">Double-Hop (Use a Bastion)</a></h3>
<div class="outline-text-3" id="text-org889495f">
<pre class="example" id="org28811b0">
:dir /ssh:ec2-user@1.2.3.4|ssh:ec2-user@10.192.1.2:/
</pre>
</div>
</div>
</div>

<div id="outline-container-orga58983f" class="outline-2">
<h2 id="orga58983f"><a href="#orga58983f">Copy File to Remote Machine</a></h2>
<div class="outline-text-2" id="text-orga58983f">
<p>
This leverages my <code>host</code> function.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span>copy-file MyFile <span style="color: #c678dd;">(</span>host <span style="color: #98be65;">"ec2-user"</span> <span style="color: #98be65;">"/tmp/my_file.txt"</span> 'sudo<span style="color: #c678dd;">)</span> t<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0590eff" class="outline-2">
<h2 id="org0590eff"><a href="#org0590eff">IP Address Variable</a></h2>
<div class="outline-text-2" id="text-org0590eff">
<p>
Because you don't want to hard-code IP addresses in your source blocks like
some kind of animal!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">host</span> <span style="color: #c678dd;">(</span>user ip path <span style="color: #ECBE7B;">&amp;optional</span> sudo<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return a TRAMP string for SSHing to a remote host.</span>
<span style="color: #83898d;">USER is a user name on the remote host IP. PATH is the path on</span>
<span style="color: #83898d;">the remote host at which to execute the source block. If SUDO is</span>
<span style="color: #83898d;">non-nil, use sudo on the remote host."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> sudo
      <span style="color: #98be65;">(</span><span style="color: #51afef;">s-lex-format</span> <span style="color: #98be65;">"/ssh:${user}@${ip}|sudo:${ip}:${path}"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">s-lex-format</span> <span style="color: #98be65;">"/ssh:${user}@${ip}:${path}"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Then set variables at the top of a file, and use something like:
</p>

<pre class="example" id="org4472adf">
#+begin_src bash :dir (host (getenv "HOST") (getenv "USER") "/home/ec2-user")
  pwd
#+end_src
</pre>
</div>
</div>
</div>
</body>
</html>
