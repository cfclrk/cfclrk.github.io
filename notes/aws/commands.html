<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AWS Commands</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/main.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id="navbar" class="cf">
  <ul class="cf">
    <li class="fl">
      <a href="/">cfclrk</a>
    </li>
    <li class="fr">
      <a href="/articles/home.html">Articles</a>
    </li>
    <li class="fr">
      <a href="/notes/home.html">Notes</a>
    </li>
	<li class="fr">
      <a href="/cloudformation/home.html">CloudFormation</a>
    </li>
  </ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">AWS Commands</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge1218c1">Account</a></li>
<li><a href="#org2881581">IP Address Ranges</a>
<ul>
<li><a href="#orge4c1e04">Get Region of IP</a></li>
</ul>
</li>
<li><a href="#org392c093">All Regions</a>
<ul>
<li><a href="#org4ab62d8">All Regions in Partition</a></li>
<li><a href="#orgefbe348">All Regions in All Partitions</a></li>
<li><a href="#orgcd2e1a9">Run a Command in All Regions</a></li>
</ul>
</li>
<li><a href="#org79a5207">ACM</a>
<ul>
<li><a href="#org683612e">List</a></li>
<li><a href="#org772f6fd">Describe</a></li>
<li><a href="#orgf85872b">Get Certificate</a></li>
<li><a href="#orgb36c2a6">Get Certificate PEM File</a></li>
</ul>
</li>
<li><a href="#org8a8245f">API Gateway V2</a>
<ul>
<li><a href="#orgf6386ee">List APIs</a></li>
</ul>
</li>
<li><a href="#orgedd37cf">CloudFormation</a>
<ul>
<li><a href="#orged7557e">View Stack Log</a></li>
<li><a href="#orgdad30eb">List Stacks</a></li>
<li><a href="#orgf75e9fe">Stack Outputs</a></li>
<li><a href="#org03076c8">Get Stack Parameters</a></li>
<li><a href="#org46c914a">Exports</a></li>
<li><a href="#org7bb8167">Spec Files</a></li>
</ul>
</li>
<li><a href="#orgfb780d4">CloudWatch</a>
<ul>
<li><a href="#org03a3954">Delete All Alarms</a></li>
<li><a href="#orgcdcf813">Create Alarm Targeting ASG policy</a></li>
</ul>
</li>
<li><a href="#orgb065420">DynamoDB</a>
<ul>
<li><a href="#org17aac0f">Create table with local secondary index</a></li>
<li><a href="#org7a7a68b">List Tables</a></li>
<li><a href="#orgc08a6dc">Delete Tables Like a Maniac</a></li>
</ul>
</li>
<li><a href="#orgaeca500">EC2 AMIs</a>
<ul>
<li><a href="#orgb008d0b">List AMIs</a></li>
<li><a href="#org129c404">Get Latest Image</a></li>
<li><a href="#org7a974d0">Delete AMIs and EBS Snapshots</a></li>
<li><a href="#org3723c4a">List Accounts That Can Access AMI</a></li>
</ul>
</li>
<li><a href="#orgf5cfea5">EC2 KeyPairs</a>
<ul>
<li><a href="#org1751254">Create</a></li>
<li><a href="#orgc6dcd23">Describe</a></li>
<li><a href="#org3b0b668">Delete</a></li>
</ul>
</li>
<li><a href="#org2fc2446">EC2 Instance</a>
<ul>
<li><a href="#org9ef52fb">Get Running Instances</a></li>
<li><a href="#org20a7113">Get All Instance Tags</a></li>
<li><a href="#orgd5e3e70">Get Instances with Tag Key</a></li>
<li><a href="#orge6a3666">Get Instances with Tag Key/Value</a></li>
</ul>
</li>
<li><a href="#orgb1e58d1">EC2 Transit Gateway</a>
<ul>
<li><a href="#org012f4df">List Routes in a TG Route Table</a></li>
</ul>
</li>
<li><a href="#org54b9700">EC2 VPCs</a>
<ul>
<li><a href="#orga4cfab8">VPCs</a></li>
<li><a href="#orgb2c7e06">Subnets</a></li>
<li><a href="#org025560b">SecurityGroups</a></li>
<li><a href="#org37b5807">Private ALB IPs</a></li>
<li><a href="#orgf511b58">Managed Prefix Lists</a></li>
</ul>
</li>
<li><a href="#orgdc70e6d">ECR</a>
<ul>
<li><a href="#orgea06b21">Log in</a></li>
</ul>
</li>
<li><a href="#org6d96da4">ECS</a></li>
<li><a href="#org146bebf">EKS</a>
<ul>
<li><a href="#orgc8f3020">List Clusters</a></li>
<li><a href="#org9e59c2f">Get Kube Config</a></li>
</ul>
</li>
<li><a href="#org44dd9a1">Elasticache</a>
<ul>
<li><a href="#org93ffad2">List CasheClusters</a></li>
<li><a href="#orgcc12e07">List ReplicationGroups</a></li>
</ul>
</li>
<li><a href="#org0011ffd">ElasticBeanstalk</a>
<ul>
<li><a href="#orgc029c6d">Config Options for Nampespace</a></li>
</ul>
</li>
<li><a href="#org469e3fc">ElasticLoadBalancingV2</a>
<ul>
<li><a href="#orgc350375">Describe ALBs</a></li>
<li><a href="#org3f4691e">Get DNS Name</a></li>
</ul>
</li>
<li><a href="#org02200a7">GlobalAccelerator</a>
<ul>
<li><a href="#org1a83928">List Accelerators</a></li>
<li><a href="#org6ca300b">List Listeners</a></li>
<li><a href="#org483706e">IPs</a></li>
</ul>
</li>
<li><a href="#orgd07c808">IAM</a>
<ul>
<li><a href="#org7a30d24">Create Policy</a></li>
<li><a href="#orge711a99">Assume Role</a></li>
<li><a href="#orgdf1ea24">List Instance Profiles</a></li>
<li><a href="#orge17ec22">Delete Instance Profile</a></li>
</ul>
</li>
<li><a href="#orgfb7bbf2">IMDS</a></li>
<li><a href="#org89f9c83">Kinesis</a>
<ul>
<li><a href="#org18b0a6f">Delete all Kinesis Streams</a></li>
</ul>
</li>
<li><a href="#org4bf2b6e">Kinesis Firehose</a>
<ul>
<li><a href="#org7a1a860">Describe Stream</a></li>
<li><a href="#orga811522">Update Stream S3 Destination Bucket</a></li>
<li><a href="#org648d884">Update Stream S3 Destination Prefix</a></li>
</ul>
</li>
<li><a href="#org1702e20">Lambda</a>
<ul>
<li><a href="#org67f70c7">Invoke function</a></li>
<li><a href="#orgdd06401">Create Function with Zip File</a></li>
<li><a href="#org8a2bf14">Update Function code with Zip File</a></li>
<li><a href="#orgf8a4224">Container Image: Run Interactively</a></li>
</ul>
</li>
<li><a href="#orgf157f6e">Organizations</a></li>
<li><a href="#orgbb6cf4d">Polly</a>
<ul>
<li><a href="#orgc546c6d">Say something from insultgenerator.org</a></li>
</ul>
</li>
<li><a href="#orgab60f32">Reosurce Access Manager (RAM)</a></li>
<li><a href="#org55d0fc3">Route53</a>
<ul>
<li><a href="#orgb5761ba">Get HostedZoneId from Name</a></li>
<li><a href="#org6ace9e4">List Records for a HostedZone</a></li>
</ul>
</li>
<li><a href="#orga69987c">SecretsManager</a>
<ul>
<li><a href="#orgfb0ed36">List Secrets</a></li>
<li><a href="#org588c094">Get Secret</a></li>
<li><a href="#orgc4a3013">Create Secret</a></li>
</ul>
</li>
<li><a href="#org8fce1e7">ServiceCatalog</a>
<ul>
<li><a href="#orgec228b4">Get Product IDs</a></li>
<li><a href="#org79414b7">Launch Product</a></li>
</ul>
</li>
<li><a href="#orgdea666c">Service Quotas</a>
<ul>
<li><a href="#org90b917a">Get Quota</a></li>
<li><a href="#org9305da2">Get Default Quota</a></li>
</ul>
</li>
<li><a href="#org1f03d16">S3</a>
<ul>
<li><a href="#org32286c5">Canonical ID</a></li>
<li><a href="#org2e8b212">List objects in bucket</a></li>
<li><a href="#org22fdcec">Get Object</a></li>
<li><a href="#org4cd11b1">Get bucket policy</a></li>
<li><a href="#org9db094d">Delete Buckets with Name</a></li>
</ul>
</li>
<li><a href="#org763ada6">SNS</a>
<ul>
<li><a href="#org497ba1a">SNS topics</a></li>
</ul>
</li>
<li><a href="#org4bd4d2a">SQS</a>
<ul>
<li><a href="#orga7bdbc7">List Queues</a></li>
</ul>
</li>
<li><a href="#org1cb379f">SSO</a>
<ul>
<li><a href="#org88d92c0">Token</a></li>
<li><a href="#org820fb98">List Accounts I Can Access</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-orge1218c1" class="outline-2">
<h2 id="orge1218c1"><a href="#orge1218c1">Account</a></h2>
<div class="outline-text-2" id="text-orge1218c1">
<p>
Account number:
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org7e1d8dd">aws sts get-caller-identity --query <span style="color: #98be65;">'Account'</span> --output text
</pre>
</div>
</div>
</div>

<div id="outline-container-org2881581" class="outline-2">
<h2 id="org2881581"><a href="#org2881581">IP Address Ranges</a></h2>
<div class="outline-text-2" id="text-org2881581">
<p>
AWS documentation is <a href="https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org1f52d6e">curl -s https://ip-ranges.amazonaws.com/ip-ranges.json
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cat <span style="color: #98be65;">"$IpRanges"</span> | jq <span style="color: #98be65;">'.prefixes[] | select(.region = "us-east-2") | .ip_prefix'</span>
</pre>
</div>
</div>

<div id="outline-container-orge4c1e04" class="outline-3">
<h3 id="orge4c1e04"><a href="#orge4c1e04">Get Region of IP</a></h3>
<div class="outline-text-3" id="text-orge4c1e04">
<p>
(Would be cool).
</p>

<p>
Check IP address against each CIDR range. Would be cool to do this using bit
comparisons.
</p>

<p>
See: <a href="https://unix.stackexchange.com/questions/274330/check-ip-is-in-range-of-whitelist-array">https://unix.stackexchange.com/questions/274330/check-ip-is-in-range-of-whitelist-array</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org392c093" class="outline-2">
<h2 id="org392c093"><a href="#org392c093">All Regions</a></h2>
<div class="outline-text-2" id="text-org392c093">
</div>
<div id="outline-container-org4ab62d8" class="outline-3">
<h3 id="org4ab62d8"><a href="#org4ab62d8">All Regions in Partition</a></h3>
<div class="outline-text-3" id="text-org4ab62d8">
<div class="org-src-container">
<pre class="src src-sh" id="org8734777">aws ec2 describe-regions | jq -r <span style="color: #98be65;">".Regions[].RegionName"</span>
</pre>
</div>

<pre class="example" id="org2ed4496">
eu-north-1
ap-south-1
eu-west-3
eu-west-2
eu-west-1
ap-northeast-3
ap-northeast-2
ap-northeast-1
sa-east-1
ca-central-1
ap-southeast-1
ap-southeast-2
eu-central-1
us-east-1
us-east-2
us-west-1
us-west-2
</pre>

<p>
Number of regions:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">AllRegions</span> | wc -w
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Or use an array</span>
<span style="color: #dcaeea;">regions</span>=($<span style="color: #dcaeea;">AllRegions</span>)
<span style="color: #c678dd;">echo</span> ${#<span style="color: #dcaeea;">regions</span>[*]}
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
      17
17
</pre>
</div>
</div>

<div id="outline-container-orgefbe348" class="outline-3">
<h3 id="orgefbe348"><a href="#orgefbe348">All Regions in All Partitions</a></h3>
<div class="outline-text-3" id="text-orgefbe348">
<p>
Should be in the botocore data files. Also, we can pull them from the IpRanges
document. You have to decide whether "GLOBAL" is a "region" in your situation.
</p>

<div class="org-src-container">
<pre class="src src-sh">cat <span style="color: #98be65;">"$IpRanges"</span> | jq -r <span style="color: #98be65;">'.prefixes[].region'</span> | sort | uniq
</pre>
</div>

<pre class="example" id="org5686ed6">
GLOBAL
af-south-1
ap-east-1
ap-northeast-1
ap-northeast-2
ap-northeast-3
ap-south-1
ap-south-2
ap-southeast-1
ap-southeast-2
ap-southeast-3
ap-southeast-4
ca-central-1
cn-north-1
cn-northwest-1
eu-central-1
eu-central-2
eu-north-1
eu-south-1
eu-south-2
eu-west-1
eu-west-2
eu-west-3
me-south-1
sa-east-1
us-east-1
us-east-2
us-gov-east-1
us-gov-west-1
us-west-1
us-west-2
</pre>
</div>
</div>

<div id="outline-container-orgcd2e1a9" class="outline-3">
<h3 id="orgcd2e1a9"><a href="#orgcd2e1a9">Run a Command in All Regions</a></h3>
<div class="outline-text-3" id="text-orgcd2e1a9">
<p>
Get the number of VPCs in each region the slow and simple way.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">for</span> region<span style="color: #51afef;"> in</span> $<span style="color: #dcaeea;">AllRegions</span>; <span style="color: #51afef;">do</span>
    <span style="color: #dcaeea;">vpcs</span>=($(aws --region $<span style="color: #dcaeea;">region</span> ec2 describe-vpcs | jq <span style="color: #98be65;">'.Vpcs[].VpcId'</span>))
    <span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"$region: ${#vpcs[*]}"</span>
<span style="color: #51afef;">done</span>
</pre>
</div>

<pre class="example" id="org2414330">
eu-north-1: 0
ap-south-1: 0
eu-west-3: 0
eu-west-2: 0
eu-west-1: 0
ap-northeast-3: 1
ap-northeast-2: 0
ap-northeast-1: 0
sa-east-1: 0
ca-central-1: 0
ap-southeast-1: 1
ap-southeast-2: 0
eu-central-1: 0
us-east-1: 2
us-east-2: 2
us-west-1: 0
us-west-2: 0
</pre>

<p>
Get the number of VPCs in each region the 🚀 and 😎 (and 🤮) way by starting a
subprocess for each region in parallel. Note that <code>${#regions[*]}</code> is bash
syntax for th length of the <code>$regions</code> array.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">script</span>=$(cat &lt;&lt;-<span style="color: #98be65;">"EOF"</span>
<span style="color: #98be65;">vpcs=($(aws --region {} ec2 describe-vpcs | jq '.Vpcs[].VpcId'))</span>
<span style="color: #98be65;">echo "{}: ${#vpcs[*]}"</span>
<span style="color: #98be65;">EOF</span>
)
<span style="color: #dcaeea;">regions</span>=($<span style="color: #dcaeea;">AllRegions</span>)
<span style="color: #c678dd;">echo</span> ${<span style="color: #dcaeea;">regions</span>[*]} | xargs -n 1 -P ${#<span style="color: #dcaeea;">regions</span>[*]} -I {} bash -c <span style="color: #98be65;">"$script"</span>
</pre>
</div>

<pre class="example" id="orgcc98d3f">
us-east-1: 2
ca-central-1: 0
us-east-2: 2
us-west-1: 0
eu-west-3: 0
eu-west-2: 0
eu-west-1: 0
us-west-2: 0
eu-central-1: 0
eu-north-1: 0
sa-east-1: 0
ap-northeast-3: 1
ap-northeast-1: 0
ap-northeast-2: 0
ap-southeast-2: 0
ap-south-1: 0
ap-southeast-1: 1
</pre>
</div>
</div>
</div>

<div id="outline-container-org79a5207" class="outline-2">
<h2 id="org79a5207"><a href="#org79a5207">ACM</a></h2>
<div class="outline-text-2" id="text-org79a5207">
</div>
<div id="outline-container-org683612e" class="outline-3">
<h3 id="org683612e"><a href="#org683612e">List</a></h3>
<div class="outline-text-3" id="text-org683612e">
<div class="org-src-container">
<pre class="src src-sh">aws acm list-certificates --includes <span style="color: #98be65;">"keyUsage=ANY"</span> | jq <span style="color: #98be65;">'.CertificateSummaryList[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org772f6fd" class="outline-3">
<h3 id="org772f6fd"><a href="#org772f6fd">Describe</a></h3>
<div class="outline-text-3" id="text-org772f6fd">
<div class="org-src-container">
<pre class="src src-sh">aws acm describe-certificate --certificate-arn $<span style="color: #dcaeea;">CertArn</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf85872b" class="outline-3">
<h3 id="orgf85872b"><a href="#orgf85872b">Get Certificate</a></h3>
<div class="outline-text-3" id="text-orgf85872b">
<div class="org-src-container">
<pre class="src src-sh">aws acm get-certificate --certificate-arn $<span style="color: #dcaeea;">CertificateArn</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb36c2a6" class="outline-3">
<h3 id="orgb36c2a6"><a href="#orgb36c2a6">Get Certificate PEM File</a></h3>
<div class="outline-text-3" id="text-orgb36c2a6">
<div class="org-src-container">
<pre class="src src-sh">aws acm get-certificate --certificate-arn $<span style="color: #dcaeea;">CertificateArn</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Certificate'</span> &gt; route_guide_cert.pem
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cat appliance_cert.pem
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8a8245f" class="outline-2">
<h2 id="org8a8245f"><a href="#org8a8245f">API Gateway V2</a></h2>
<div class="outline-text-2" id="text-org8a8245f">
</div>
<div id="outline-container-orgf6386ee" class="outline-3">
<h3 id="orgf6386ee"><a href="#orgf6386ee">List APIs</a></h3>
<div class="outline-text-3" id="text-orgf6386ee">
<div class="org-src-container">
<pre class="src src-sh">aws apigatewayv2 get-apis | jq <span style="color: #98be65;">'.Items[]'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgedd37cf" class="outline-2">
<h2 id="orgedd37cf"><a href="#orgedd37cf">CloudFormation</a></h2>
<div class="outline-text-2" id="text-orgedd37cf">
<p>
For create/deploy/update, see my <a href="https://github.com/cfclrk/cloudformation/blob/main/README.org">cloudformation/README.org</a>.
</p>
</div>

<div id="outline-container-orged7557e" class="outline-3">
<h3 id="orged7557e"><a href="#orged7557e">View Stack Log</a></h3>
<div class="outline-text-3" id="text-orged7557e">
<div class="org-src-container">
<pre class="src src-sh">aws cloudformation list-stacks <span style="color: #98be65;">\</span>
    | jq -M <span style="color: #98be65;">'.StackSummaries[0].StackId'</span> <span style="color: #98be65;">\</span>
    | xargs aws cloudformation describe-stack-events --stack-name
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdad30eb" class="outline-3">
<h3 id="orgdad30eb"><a href="#orgdad30eb">List Stacks</a></h3>
<div class="outline-text-3" id="text-orgdad30eb">
<p>
List only the created stacks
</p>

<div class="org-src-container">
<pre class="src src-sh">aws cloudformation list-stacks <span style="color: #98be65;">\</span>
    --stack-status-filter CREATE_IN_PROGRESS CREATE_COMPLETE
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf75e9fe" class="outline-3">
<h3 id="orgf75e9fe"><a href="#orgf75e9fe">Stack Outputs</a></h3>
<div class="outline-text-3" id="text-orgf75e9fe">
<div class="org-src-container">
<pre class="src src-sh">aws cloudformation describe-stacks <span style="color: #98be65;">\</span>
    --stack-name $<span style="color: #dcaeea;">StackName</span> <span style="color: #98be65;">\</span>
   | jq <span style="color: #98be65;">'.Stacks[].Outputs[]'</span>
</pre>
</div>

<p>
Get the value of a single output:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws cloudformation describe-stacks <span style="color: #98be65;">\</span>
    --stack-name $<span style="color: #dcaeea;">StackName</span> <span style="color: #98be65;">\</span>
    --query <span style="color: #98be65;">"Stacks[0].Outputs[?OutputKey=='$OutputKey'].OutputValue"</span> <span style="color: #98be65;">\</span>
    --output text
</pre>
</div>
</div>
</div>

<div id="outline-container-org03076c8" class="outline-3">
<h3 id="org03076c8"><a href="#org03076c8">Get Stack Parameters</a></h3>
<div class="outline-text-3" id="text-org03076c8">
<p>
Get all parameters used to create a particular stack:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws cloudformation describe-stacks <span style="color: #98be65;">\</span>
    --stack-name $<span style="color: #dcaeea;">StackName</span> <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.Stacks[].Parameters[]'</span>
</pre>
</div>

<p>
Get the value of a single parameter:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws cloudformation describe-stacks <span style="color: #98be65;">\</span>
    --stack-name $<span style="color: #dcaeea;">StackName</span> <span style="color: #98be65;">\</span>
    --query <span style="color: #98be65;">"Stacks[0].Parameters[?ParameterKey=='$Parameter'].ParameterValue"</span> <span style="color: #98be65;">\</span>
    --output text
</pre>
</div>
</div>
</div>

<div id="outline-container-org46c914a" class="outline-3">
<h3 id="org46c914a"><a href="#org46c914a">Exports</a></h3>
<div class="outline-text-3" id="text-org46c914a">
<p>
Get value of the exported field with name <code>$ExportName</code>:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws cloudformation list-exports <span style="color: #98be65;">\</span>
    --query <span style="color: #98be65;">"Exports[?Name=='$ExportName'].Value"</span> <span style="color: #98be65;">\</span>
    --output text
</pre>
</div>

<p>
List exports that start with a string:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws cloudformation list-exports <span style="color: #98be65;">\</span>
    --query <span style="color: #98be65;">"Exports[?starts_with(Name, 'foo-')].[Name, Value]"</span> <span style="color: #98be65;">\</span>
    --output text
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bb8167" class="outline-3">
<h3 id="org7bb8167"><a href="#org7bb8167">Spec Files</a></h3>
<div class="outline-text-3" id="text-org7bb8167">
<p>
Spec files are documented <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-resource-specification.html">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-sh">curl https://dnwj8swjjbsbt.cloudfront.net/latest/CloudFormationResourceSpecification.zip <span style="color: #98be65;">\</span>
     -o us_east_2.zip
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb780d4" class="outline-2">
<h2 id="orgfb780d4"><a href="#orgfb780d4">CloudWatch</a></h2>
<div class="outline-text-2" id="text-orgfb780d4">
</div>
<div id="outline-container-org03a3954" class="outline-3">
<h3 id="org03a3954"><a href="#org03a3954">Delete All Alarms</a></h3>
<div class="outline-text-3" id="text-org03a3954">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">alarms</span>=$(aws cloudwatch describe-alarms <span style="color: #98be65;">\</span>
             | jq -r <span style="color: #98be65;">'.MetricAlarms[].AlarmName'</span>)
<span style="color: #51afef;">for</span> alarm<span style="color: #51afef;"> in</span> $<span style="color: #dcaeea;">alarms</span>; <span style="color: #51afef;">do</span>
    aws cloudwatch delete-alarms --alarm-names $<span style="color: #dcaeea;">alarm</span>;
<span style="color: #51afef;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcdcf813" class="outline-3">
<h3 id="orgcdcf813"><a href="#orgcdcf813">Create Alarm Targeting ASG policy</a></h3>
<div class="outline-text-3" id="text-orgcdcf813">
<div class="org-src-container">
<pre class="src src-sh">aws cloudwatch put-metric-alarm <span style="color: #98be65;">\</span>
    --alarm-name AddCapacity <span style="color: #98be65;">\</span>
    --metric-name CPUUtilization <span style="color: #98be65;">\</span>
    --namespace AWS/EC2 <span style="color: #98be65;">\</span>
    --statistic Average <span style="color: #98be65;">\</span>
    --period 120 <span style="color: #98be65;">\</span>
    --threshold 80 <span style="color: #98be65;">\</span>
    --comparison-operator GreaterThanOrEqualToThreshold <span style="color: #98be65;">\</span>
    --dimensions <span style="color: #98be65;">"Name=AutoScalingGroupName,Value=my-asg"</span> <span style="color: #98be65;">\</span>
    --evaluation-periods 2 <span style="color: #98be65;">\</span>
    --alarm-actions $<span style="color: #dcaeea;">ScalingPolicyArn</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb065420" class="outline-2">
<h2 id="orgb065420"><a href="#orgb065420">DynamoDB</a></h2>
<div class="outline-text-2" id="text-orgb065420">
<p>
The paper: <a href="https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf">Dynamo: Amazon’s Highly Available Key-value Store</a>. This describes a
distributed database with a leaderless replication model.
</p>

<p>
From <a href="https://shop.aer.io/oreilly/p/designing-data-intensive-applications/9781449373320-9149">Designing Data-Intensive Applications</a> by Martin Kleppmann:
</p>

<blockquote>
<p>
Dynamo is not available to users outside of Amazon. Confusingly, AWS offers a
hosted database product called DynamoDB, which uses a completely different
architecture: it is based on single-leader replication.
</p>
</blockquote>
</div>

<div id="outline-container-org17aac0f" class="outline-3">
<h3 id="org17aac0f"><a href="#org17aac0f">Create table with local secondary index</a></h3>
<div class="outline-text-3" id="text-org17aac0f">
<div class="org-src-container">
<pre class="src src-sh">aws dynamodb create-table <span style="color: #98be65;">\</span>
    --table-name MusicCollection2 <span style="color: #98be65;">\</span>
    --attribute-definitions <span style="color: #dcaeea;">AttributeName</span>=Artist,<span style="color: #dcaeea;">AttributeType</span>=S <span style="color: #dcaeea;">AttributeName</span>=SongTitle,<span style="color: #dcaeea;">AttributeType</span>=S <span style="color: #dcaeea;">AttributeName</span>=Score,<span style="color: #dcaeea;">AttributeType</span>=S <span style="color: #98be65;">\</span>
    --key-schema <span style="color: #dcaeea;">AttributeName</span>=Artist,<span style="color: #dcaeea;">KeyType</span>=HASH <span style="color: #dcaeea;">AttributeName</span>=SongTitle,<span style="color: #dcaeea;">KeyType</span>=RANGE <span style="color: #98be65;">\</span>
    --provisioned-throughput <span style="color: #dcaeea;">ReadCapacityUnits</span>=5,<span style="color: #dcaeea;">WriteCapacityUnits</span>=5 <span style="color: #98be65;">\</span>
    --local-secondary-indexes <span style="color: #98be65;">"IndexName=SuperCat,KeySchema=[{AttributeName=Artist,KeyType=HASH},{AttributeName=Score,KeyType=RANGE}],Projection={ProjectionType=KEYS_ONLY}"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a7a68b" class="outline-3">
<h3 id="org7a7a68b"><a href="#org7a7a68b">List Tables</a></h3>
<div class="outline-text-3" id="text-org7a7a68b">
<div class="org-src-container">
<pre class="src src-sh">aws dynamodb  list-tables | jq <span style="color: #98be65;">'.TableNames[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc08a6dc" class="outline-3">
<h3 id="orgc08a6dc"><a href="#orgc08a6dc">Delete Tables Like a Maniac</a></h3>
<div class="outline-text-3" id="text-orgc08a6dc">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> ${<span style="color: #dcaeea;">tables</span>[*]} <span style="color: #98be65;">\</span>
    | xargs -n 1 -P 10 -I {} sh -c <span style="color: #98be65;">\</span>
            <span style="color: #98be65;">'aws dynamodb delete-table --table-name {} &amp;&amp; aws dynamodb wait table-not-exists --table-name {}'</span>
</pre>
</div>

<p>
TODO: When I originally wrote this, I remember needing to add a <code>tr " " "\n"</code>
or something for portability with Linux. Test this out again.
</p>
</div>
</div>
</div>

<div id="outline-container-orgaeca500" class="outline-2">
<h2 id="orgaeca500"><a href="#orgaeca500">EC2 AMIs</a></h2>
<div class="outline-text-2" id="text-orgaeca500">
</div>
<div id="outline-container-orgb008d0b" class="outline-3">
<h3 id="orgb008d0b"><a href="#orgb008d0b">List AMIs</a></h3>
<div class="outline-text-3" id="text-orgb008d0b">
<p>
All of this account's AMIs:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-images --owners $<span style="color: #dcaeea;">Account</span>
</pre>
</div>

<p>
All of this account's AMIs with a particular Name tag:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-images <span style="color: #98be65;">\</span>
    --owners $<span style="color: #dcaeea;">account</span> <span style="color: #98be65;">\</span>
    --filters <span style="color: #98be65;">"Name=tag:Name,Values=My AMI"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org129c404" class="outline-3">
<h3 id="org129c404"><a href="#org129c404">Get Latest Image</a></h3>
<div class="outline-text-3" id="text-org129c404">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-images <span style="color: #98be65;">\</span>
    --owners $<span style="color: #dcaeea;">Account</span> <span style="color: #98be65;">\</span>
    --filters <span style="color: #98be65;">"Name=state,Values=available"</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Images | sort_by(.CreationDate) | last | .ImageId'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a974d0" class="outline-3">
<h3 id="org7a974d0"><a href="#org7a974d0">Delete AMIs and EBS Snapshots</a></h3>
<div class="outline-text-3" id="text-org7a974d0">
<p>
List AMIs to delete and set to variable <code>AmisToDelete</code>. Then:
</p>

<div class="org-src-container">
<pre class="src src-sh">jq -c <span style="color: #98be65;">'.Images</span>
<span style="color: #98be65;">       | sort_by(.CreationDate)</span>
<span style="color: #98be65;">       | .[]</span>
<span style="color: #98be65;">       | {name: .Name, snap: .BlockDeviceMappings[]</span>
<span style="color: #98be65;">       | select(.Ebs != null)</span>
<span style="color: #98be65;">       | .Ebs.SnapshotId}'</span> &lt; $<span style="color: #dcaeea;">AmisToDelete</span> &gt; images.txt
</pre>
</div>

<p>
And then&#x2026; what did I do?
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">for</span> i<span style="color: #51afef;"> in</span> (cat images.txt | jq); <span style="color: #51afef;">do</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">deregister image</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">delete the snapshot</span>
<span style="color: #51afef;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3723c4a" class="outline-3">
<h3 id="org3723c4a"><a href="#org3723c4a">List Accounts That Can Access AMI</a></h3>
<div class="outline-text-3" id="text-org3723c4a">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-image-attribute <span style="color: #98be65;">\</span>
    --image-id $<span style="color: #dcaeea;">ImageID</span> <span style="color: #98be65;">\</span>
    --attribute launchPermission
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf5cfea5" class="outline-2">
<h2 id="orgf5cfea5"><a href="#orgf5cfea5">EC2 KeyPairs</a></h2>
<div class="outline-text-2" id="text-orgf5cfea5">
</div>
<div id="outline-container-org1751254" class="outline-3">
<h3 id="org1751254"><a href="#org1751254">Create</a></h3>
<div class="outline-text-3" id="text-org1751254">
<div class="org-src-container">
<pre class="src src-sh" id="org22c13e4">aws ec2 create-key-pair --key-name $<span style="color: #dcaeea;">KeyName</span>
</pre>
</div>

<p>
Copy private key to <code>~/.ssh</code>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #dcaeea;">KeyName</span>=$(<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">KeyPair</span> | jq -r <span style="color: #98be65;">'.KeyName'</span>)
<span style="color: #dcaeea;">KeyFile</span>=~/.ssh/$<span style="color: #dcaeea;">dir</span>/$<span style="color: #dcaeea;">KeyName</span>
<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">KeyPair</span> | jq -r <span style="color: #98be65;">'.KeyMaterial'</span> &gt; $<span style="color: #dcaeea;">KeyFile</span>
chmod 0600 $<span style="color: #dcaeea;">KeyFile</span>
<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">KeyFile</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6dcd23" class="outline-3">
<h3 id="orgc6dcd23"><a href="#orgc6dcd23">Describe</a></h3>
<div class="outline-text-3" id="text-orgc6dcd23">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-key-pairs | jq <span style="color: #98be65;">'.KeyPairs[]'</span>
</pre>
</div>

<pre class="example" id="org2ef982d">
{
  "KeyPairId": "key-086cc980cd005be07",
  "KeyFingerprint": "d2:51:6b:bd:8a:af:cd:91:23:7f:12:b8:c9:a9:ed:87",
  "KeyName": "chrisclark",
  "Tags": []
}
{
  "KeyPairId": "key-0e4a6a6133dcfbff4",
  "KeyFingerprint": "47:b3:fa:a0:72:c7:78:d2:6c:52:88:83:e1:b9:e1:59:79:2d:86:5c",
  "KeyName": "test",
  "Tags": []
}
</pre>
</div>
</div>

<div id="outline-container-org3b0b668" class="outline-3">
<h3 id="org3b0b668"><a href="#org3b0b668">Delete</a></h3>
<div class="outline-text-3" id="text-org3b0b668">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 delete-key-pair --key-name $<span style="color: #dcaeea;">KeyName</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2fc2446" class="outline-2">
<h2 id="org2fc2446"><a href="#org2fc2446">EC2 Instance</a></h2>
<div class="outline-text-2" id="text-org2fc2446">
</div>
<div id="outline-container-org9ef52fb" class="outline-3">
<h3 id="org9ef52fb"><a href="#org9ef52fb">Get Running Instances</a></h3>
<div class="outline-text-3" id="text-org9ef52fb">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-instances <span style="color: #98be65;">\</span>
    --query <span style="color: #98be65;">"Reservations[].Instances[?State.name=="</span>running<span style="color: #98be65;">"]"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org20a7113" class="outline-3">
<h3 id="org20a7113"><a href="#org20a7113">Get All Instance Tags</a></h3>
<div class="outline-text-3" id="text-org20a7113">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-instances <span style="color: #98be65;">\</span>
    | jq -c <span style="color: #98be65;">'.Reservations[] | .Instances[] | .Tags[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5e3e70" class="outline-3">
<h3 id="orgd5e3e70"><a href="#orgd5e3e70">Get Instances with Tag Key</a></h3>
<div class="outline-text-3" id="text-orgd5e3e70">
<p>
With just a specific Tag key, disregarding value:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-instances <span style="color: #98be65;">\</span>
    --filter <span style="color: #98be65;">"Name=tag-key,Values=k8s.io/role/node"</span> <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.Reservations[].Instances[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6a3666" class="outline-3">
<h3 id="orge6a3666"><a href="#orge6a3666">Get Instances with Tag Key/Value</a></h3>
<div class="outline-text-3" id="text-orge6a3666">
<p>
With just a specific Tag key:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-instances <span style="color: #98be65;">\</span>
    --filter <span style="color: #98be65;">"Name=tag:$TagName,Values=$TagValue"</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Reservations[].Instances[].Tags[] | select(.Key == "Name") | .Value'</span>
</pre>
</div>

<p>
With a specific tag key and value
</p>
</div>
</div>
</div>

<div id="outline-container-orgb1e58d1" class="outline-2">
<h2 id="orgb1e58d1"><a href="#orgb1e58d1">EC2 Transit Gateway</a></h2>
<div class="outline-text-2" id="text-orgb1e58d1">
</div>
<div id="outline-container-org012f4df" class="outline-3">
<h3 id="org012f4df"><a href="#org012f4df">List Routes in a TG Route Table</a></h3>
<div class="outline-text-3" id="text-org012f4df">
<div class="org-src-container">
<pre class="src src-sh">aws --profile shared-services --region us-east-1 <span style="color: #98be65;">\</span>
    ec2 search-transit-gateway-routes <span style="color: #98be65;">\</span>
    --transit-gateway-route-table-id $<span style="color: #dcaeea;">TGWRouteTableId</span> <span style="color: #98be65;">\</span>
    --filters <span style="color: #98be65;">"Name=type,Values=propagated"</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Routes[].DestinationCidrBlock'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org54b9700" class="outline-2">
<h2 id="org54b9700"><a href="#org54b9700">EC2 VPCs</a></h2>
<div class="outline-text-2" id="text-org54b9700">
</div>
<div id="outline-container-orga4cfab8" class="outline-3">
<h3 id="orga4cfab8"><a href="#orga4cfab8">VPCs</a></h3>
<div class="outline-text-3" id="text-orga4cfab8">
<div class="org-src-container">
<pre class="src src-bash">aws ec2 describe-vpcs | jq <span style="color: #98be65;">'.Vpcs[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2c7e06" class="outline-3">
<h3 id="orgb2c7e06"><a href="#orgb2c7e06">Subnets</a></h3>
<div class="outline-text-3" id="text-orgb2c7e06">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-subnets  | jq <span style="color: #98be65;">'.Subnets'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org025560b" class="outline-3">
<h3 id="org025560b"><a href="#org025560b">SecurityGroups</a></h3>
<div class="outline-text-3" id="text-org025560b">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-security-groups  | jq <span style="color: #98be65;">'.SecurityGroups'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org37b5807" class="outline-3">
<h3 id="org37b5807"><a href="#org37b5807">Private ALB IPs</a></h3>
<div class="outline-text-3" id="text-org37b5807">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-network-interfaces <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.NetworkInterfaces[]</span>
<span style="color: #98be65;">          | select(.Attachment.InstanceOwnerId == "amazon-elb")</span>
<span style="color: #98be65;">          | .PrivateIpAddress'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf511b58" class="outline-3">
<h3 id="orgf511b58"><a href="#orgf511b58">Managed Prefix Lists</a></h3>
<div class="outline-text-3" id="text-orgf511b58">
<div class="org-src-container">
<pre class="src src-sh">aws ec2 describe-managed-prefix-lists | jq <span style="color: #98be65;">'.PrefixLists[]'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">aws ec2 get-managed-prefix-list-entries <span style="color: #98be65;">\</span>
    --prefix-list-id $<span style="color: #dcaeea;">plid</span> | jq <span style="color: #98be65;">'.Entries[]'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdc70e6d" class="outline-2">
<h2 id="orgdc70e6d"><a href="#orgdc70e6d">ECR</a></h2>
<div class="outline-text-2" id="text-orgdc70e6d">
</div>
<div id="outline-container-orgea06b21" class="outline-3">
<h3 id="orgea06b21"><a href="#orgea06b21">Log in</a></h3>
<div class="outline-text-3" id="text-orgea06b21">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">PW</span>=$(aws ecr get-login-password)
docker login <span style="color: #98be65;">\</span>
       --username AWS <span style="color: #98be65;">\</span>
       --password <span style="color: #98be65;">"$PW"</span> <span style="color: #98be65;">\</span>
       <span style="color: #98be65;">"https://$Account.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6d96da4" class="outline-2">
<h2 id="org6d96da4"><a href="#org6d96da4">ECS</a></h2>
<div class="outline-text-2" id="text-org6d96da4">
<p>
Fix a CloudFormation deployment where an ECS service fails to stabilize. Taken
from <a href="https://aws.amazon.com/premiumsupport/knowledge-center/cloudformation-ecs-service-stabilize/">this</a> AWS blog post. Just updates the number of ECS service tasks to 0.
</p>

<div class="org-src-container">
<pre class="src src-sh">aws ecs update-service <span style="color: #98be65;">\</span>
    --cluster $<span style="color: #dcaeea;">ECS_CLUSTER_NAME</span> <span style="color: #98be65;">\</span>
    --service $<span style="color: #dcaeea;">ECS_SERVICE_NAME</span> <span style="color: #98be65;">\</span>
    --desired-count 0
</pre>
</div>
</div>
</div>

<div id="outline-container-org146bebf" class="outline-2">
<h2 id="org146bebf"><a href="#org146bebf">EKS</a></h2>
<div class="outline-text-2" id="text-org146bebf">
</div>
<div id="outline-container-orgc8f3020" class="outline-3">
<h3 id="orgc8f3020"><a href="#orgc8f3020">List Clusters</a></h3>
<div class="outline-text-3" id="text-orgc8f3020">
<div class="org-src-container">
<pre class="src src-sh">aws eks list-clusters | jq <span style="color: #98be65;">'.clusters[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e59c2f" class="outline-3">
<h3 id="org9e59c2f"><a href="#org9e59c2f">Get Kube Config</a></h3>
<div class="outline-text-3" id="text-org9e59c2f">
<div class="org-src-container">
<pre class="src src-sh">aws eks update-kubeconfig --name $<span style="color: #dcaeea;">CLUSTER_NAME</span> --kubeconfig $<span style="color: #dcaeea;">KUBECONFIG</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org44dd9a1" class="outline-2">
<h2 id="org44dd9a1"><a href="#org44dd9a1">Elasticache</a></h2>
<div class="outline-text-2" id="text-org44dd9a1">
</div>
<div id="outline-container-org93ffad2" class="outline-3">
<h3 id="org93ffad2"><a href="#org93ffad2">List CasheClusters</a></h3>
<div class="outline-text-3" id="text-org93ffad2">
<div class="org-src-container">
<pre class="src src-sh">aws elasticache describe-cache-clusters <span style="color: #98be65;">\</span>
    --show-cache-node-info | jq <span style="color: #98be65;">'.CacheClusters'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc12e07" class="outline-3">
<h3 id="orgcc12e07"><a href="#orgcc12e07">List ReplicationGroups</a></h3>
<div class="outline-text-3" id="text-orgcc12e07">
<div class="org-src-container">
<pre class="src src-sh">aws elasticache describe-replication-groups | jq <span style="color: #98be65;">'.ReplicationGroups'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0011ffd" class="outline-2">
<h2 id="org0011ffd"><a href="#org0011ffd">ElasticBeanstalk</a></h2>
<div class="outline-text-2" id="text-org0011ffd">
</div>
<div id="outline-container-orgc029c6d" class="outline-3">
<h3 id="orgc029c6d"><a href="#orgc029c6d">Config Options for Nampespace</a></h3>
<div class="outline-text-3" id="text-orgc029c6d">
<div class="org-src-container">
<pre class="src src-sh">aws elasticbeanstalk describe-configuration-options <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.Options[]</span>
<span style="color: #98be65;">         | if .Namespace == "aws:autoscaling:launchconfiguration" then . else null end'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org469e3fc" class="outline-2">
<h2 id="org469e3fc"><a href="#org469e3fc">ElasticLoadBalancingV2</a></h2>
<div class="outline-text-2" id="text-org469e3fc">
</div>
<div id="outline-container-orgc350375" class="outline-3">
<h3 id="orgc350375"><a href="#orgc350375">Describe ALBs</a></h3>
<div class="outline-text-3" id="text-orgc350375">
<div class="org-src-container">
<pre class="src src-sh">aws elbv2 describe-load-balancers <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.LoadBalancers[] | select(.Type == "application")'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f4691e" class="outline-3">
<h3 id="org3f4691e"><a href="#org3f4691e">Get DNS Name</a></h3>
<div class="outline-text-3" id="text-org3f4691e">
<div class="org-src-container">
<pre class="src src-sh">aws elbv2 describe-load-balancers <span style="color: #98be65;">\</span>
    | jq -r --arg DEPLOYMENT_NAME <span style="color: #98be65;">"$DEPLOYMENT_NAME"</span> <span style="color: #98be65;">\</span>
         <span style="color: #98be65;">'.LoadBalancers[]</span>
<span style="color: #98be65;">          | select(.Type == "application")</span>
<span style="color: #98be65;">          | select(.LoadBalancerName | startswith($DEPLOYMENT_NAME))</span>
<span style="color: #98be65;">          | .DNSName'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org02200a7" class="outline-2">
<h2 id="org02200a7"><a href="#org02200a7">GlobalAccelerator</a></h2>
<div class="outline-text-2" id="text-org02200a7">
<p>
GlobalAccelerator is only in <code>us-west-2</code>, so set the region explicitly.
</p>
</div>

<div id="outline-container-org1a83928" class="outline-3">
<h3 id="org1a83928"><a href="#org1a83928">List Accelerators</a></h3>
<div class="outline-text-3" id="text-org1a83928">
<div class="org-src-container">
<pre class="src src-sh">aws --region us-west-2 globalaccelerator <span style="color: #98be65;">\</span>
    list-accelerators | jq <span style="color: #98be65;">'.Accelerators[]'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ca300b" class="outline-3">
<h3 id="org6ca300b"><a href="#org6ca300b">List Listeners</a></h3>
<div class="outline-text-3" id="text-org6ca300b">
<div class="org-src-container">
<pre class="src src-sh">aws --region us-west-2 globalaccelerator <span style="color: #98be65;">\</span>
    list-listeners --accelerator-arn $<span style="color: #dcaeea;">AcceleratorArn</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org483706e" class="outline-3">
<h3 id="org483706e"><a href="#org483706e">IPs</a></h3>
<div class="outline-text-3" id="text-org483706e">
<div class="org-src-container">
<pre class="src src-sh">aws --region us-west-2 globalaccelerator list-accelerators <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Accelerators[].IpSets[].IpAddresses[]'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd07c808" class="outline-2">
<h2 id="orgd07c808"><a href="#orgd07c808">IAM</a></h2>
<div class="outline-text-2" id="text-orgd07c808">
</div>
<div id="outline-container-org7a30d24" class="outline-3">
<h3 id="org7a30d24"><a href="#org7a30d24">Create Policy</a></h3>
<div class="outline-text-3" id="text-org7a30d24">
<div class="org-src-container">
<pre class="src src-sh">aws iam create-policy <span style="color: #98be65;">\</span>
    --policy-name $<span style="color: #dcaeea;">PolicyName</span> <span style="color: #98be65;">\</span>
    --policy-document <span style="color: #98be65;">'{</span>
<span style="color: #98be65;">  "Version": "2012-10-17",</span>
<span style="color: #98be65;">  "Statement": [{</span>
<span style="color: #98be65;">    "Effect": "Allow",</span>
<span style="color: #98be65;">    "Action": ["secretsmanager:GetSecretValue", "secretsmanager:DescribeSecret"],</span>
<span style="color: #98be65;">    "Resource": ["arn:*:secretsmanager:*:*:secret:MySecret-??????"]</span>
<span style="color: #98be65;">  }]</span>
<span style="color: #98be65;">}'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge711a99" class="outline-3">
<h3 id="orge711a99"><a href="#orge711a99">Assume Role</a></h3>
<div class="outline-text-3" id="text-orge711a99">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">creds</span>=$(aws sts assume-role --role-session-name foo --role-arn $<span style="color: #dcaeea;">RoleArn</span>)
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">AWS_ACCESS_KEY_ID</span>=$(<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">creds</span> | jq -r <span style="color: #98be65;">'.Credentials.AccessKeyId'</span>)
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">AWS_SECRET_ACCESS_KEY</span>=$(<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">creds</span> | jq -r <span style="color: #98be65;">'.Credentials.SecretAccessKey'</span>)
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">AWS_SESSION_TOKEN</span>=$(<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">creds</span> | jq -r <span style="color: #98be65;">'.Credentials.SessionToken'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf1ea24" class="outline-3">
<h3 id="orgdf1ea24"><a href="#orgdf1ea24">List Instance Profiles</a></h3>
<div class="outline-text-3" id="text-orgdf1ea24">
<div class="org-src-container">
<pre class="src src-sh">aws iam list-instance-profiles <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.InstanceProfiles[].InstanceProfileName'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge17ec22" class="outline-3">
<h3 id="orge17ec22"><a href="#orge17ec22">Delete Instance Profile</a></h3>
<div class="outline-text-3" id="text-orge17ec22">
<div class="org-src-container">
<pre class="src src-sh">aws iam delete-instance-profile <span style="color: #98be65;">\</span>
    --instance-profile-name $<span style="color: #dcaeea;">Name</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb7bbf2" class="outline-2">
<h2 id="orgfb7bbf2"><a href="#orgfb7bbf2">IMDS</a></h2>
<div class="outline-text-2" id="text-orgfb7bbf2">
<p>
<a href="http://169.254.169.254/latest/meta-data/">http://169.254.169.254/latest/meta-data/</a>
</p>
</div>
</div>

<div id="outline-container-org89f9c83" class="outline-2">
<h2 id="org89f9c83"><a href="#org89f9c83">Kinesis</a></h2>
<div class="outline-text-2" id="text-org89f9c83">
</div>
<div id="outline-container-org18b0a6f" class="outline-3">
<h3 id="org18b0a6f"><a href="#org18b0a6f">Delete all Kinesis Streams</a></h3>
<div class="outline-text-3" id="text-org18b0a6f">
<div class="org-src-container">
<pre class="src src-fish"><span style="color: #51afef;">for</span> <span style="color: #c678dd;">region</span> in <span style="color: #98be65;">$</span><span style="color: #dcaeea;">regions</span>
    <span style="color: #51afef;">set</span> <span style="color: #dcaeea;">streams</span> (<span style="color: #c678dd;">aws</span> --region <span style="color: #98be65;">$</span><span style="color: #dcaeea;">region</span> kinesis list-streams <span style="color: #51afef; font-weight: bold;">|</span> <span style="color: #c678dd;">jq</span> -r <span style="color: #98be65;">".StreamNames[]"</span>)
    <span style="color: #51afef;">for</span> <span style="color: #c678dd;">stream</span> in <span style="color: #98be65;">$</span><span style="color: #dcaeea;">streams</span>
        <span style="color: #c678dd;">echo</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">region</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">stream</span>
        <span style="color: #c678dd;">aws</span> --region <span style="color: #98be65;">$</span><span style="color: #dcaeea;">region</span> kinesis delete-stream --stream-name <span style="color: #98be65;">$</span><span style="color: #dcaeea;">stream</span>
    <span style="color: #51afef;">end</span>
<span style="color: #51afef;">end</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4bf2b6e" class="outline-2">
<h2 id="org4bf2b6e"><a href="#org4bf2b6e">Kinesis Firehose</a></h2>
<div class="outline-text-2" id="text-org4bf2b6e">
</div>
<div id="outline-container-org7a1a860" class="outline-3">
<h3 id="org7a1a860"><a href="#org7a1a860">Describe Stream</a></h3>
<div class="outline-text-3" id="text-org7a1a860">
<div class="org-src-container">
<pre class="src src-sh">aws firehose describe-delivery-stream <span style="color: #98be65;">\</span>
    --delivery-stream-name $<span style="color: #dcaeea;">StreamName</span> | jq <span style="color: #98be65;">'.DeliveryStreamDescription'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga811522" class="outline-3">
<h3 id="orga811522"><a href="#orga811522">Update Stream S3 Destination Bucket</a></h3>
<div class="outline-text-3" id="text-orga811522">
<div class="org-src-container">
<pre class="src src-sh">aws firehose update-destination <span style="color: #98be65;">\</span>
    --delivery-stream-name $<span style="color: #dcaeea;">StreamName</span> <span style="color: #98be65;">\</span>
    --current-delivery-stream-version-id 1 <span style="color: #98be65;">\</span>
    --destination-id destinationId-000000000001 <span style="color: #98be65;">\</span>
    --extended-s3-destination-update <span style="color: #dcaeea;">BucketARN</span>=arn:aws:s3:::$<span style="color: #dcaeea;">BucketName</span>
</pre>
</div>

<p>
THEN:
</p>
<ul class="org-ul">
<li>Update the Stream's IAM policy to allow it to write to the new location</li>
<li>Update the S3 Bucket Policy to allow the Stream's IAM Role to write to it</li>
</ul>
</div>
</div>

<div id="outline-container-org648d884" class="outline-3">
<h3 id="org648d884"><a href="#org648d884">Update Stream S3 Destination Prefix</a></h3>
<div class="outline-text-3" id="text-org648d884">
<div class="org-src-container">
<pre class="src src-sh">aws firehose update-destination <span style="color: #98be65;">\</span>
    --delivery-stream-name $<span style="color: #dcaeea;">StreamName</span> <span style="color: #98be65;">\</span>
    --current-delivery-stream-version-id 1 <span style="color: #98be65;">\</span>
    --destination-id destinationId-000000000001 <span style="color: #98be65;">\</span>
    --extended-s3-destination-update <span style="color: #dcaeea;">Prefix</span>=$<span style="color: #dcaeea;">Prefix</span>
</pre>
</div>

<p>
Also may need to update the IAM Policy and the S3 Bucket policy, as above.
</p>
</div>
</div>
</div>

<div id="outline-container-org1702e20" class="outline-2">
<h2 id="org1702e20"><a href="#org1702e20">Lambda</a></h2>
<div class="outline-text-2" id="text-org1702e20">
</div>
<div id="outline-container-org67f70c7" class="outline-3">
<h3 id="org67f70c7"><a href="#org67f70c7">Invoke function</a></h3>
<div class="outline-text-3" id="text-org67f70c7">
<div class="org-src-container">
<pre class="src src-bash">aws lambda invoke <span style="color: #98be65;">\</span>
    --cli-binary-format raw-in-base64-out <span style="color: #98be65;">\</span>
    --function-name cf-Hello-World <span style="color: #98be65;">\</span>
    /tmp/cats.json
</pre>
</div>

<p>
Invoke from a bastion host:
</p>

<div class="org-src-container">
<pre class="src src-bash">/usr/local/bin/aws lambda invoke <span style="color: #98be65;">\</span>
 --cli-binary-format raw-in-base64-out <span style="color: #98be65;">\</span>
 --function-name cf-Hello-World <span style="color: #98be65;">\</span>
 /tmp/cats.json
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cat /tmp/out.json | jq -r <span style="color: #98be65;">'.body'</span> | jq
</pre>
</div>

<p>
With payload file:
</p>

<div class="org-src-container">
<pre class="src src-bash">aws lambda invoke <span style="color: #98be65;">\</span>
    --cli-binary-format raw-in-base64-out <span style="color: #98be65;">\</span>
    --function-name hello-world <span style="color: #98be65;">\</span>
    --payload file://tests/resources/event_alb.json <span style="color: #98be65;">\</span>
    /tmp/out.json
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd06401" class="outline-3">
<h3 id="orgdd06401"><a href="#orgdd06401">Create Function with Zip File</a></h3>
<div class="outline-text-3" id="text-orgdd06401">
<div class="org-src-container">
<pre class="src src-sh">aws lambda create-function <span style="color: #98be65;">\</span>
    --function-name artifacttool <span style="color: #98be65;">\</span>
    --runtime python2.7 <span style="color: #98be65;">\</span>
    --role $<span style="color: #dcaeea;">RoleArn</span> <span style="color: #98be65;">\</span>
    --handler lambda_function.lambda_handler <span style="color: #98be65;">\</span>
    --zip-file fileb://$<span style="color: #dcaeea;">ZipFileName</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a2bf14" class="outline-3">
<h3 id="org8a2bf14"><a href="#org8a2bf14">Update Function code with Zip File</a></h3>
<div class="outline-text-3" id="text-org8a2bf14">
<div class="org-src-container">
<pre class="src src-sh">aws lambda update-function-code <span style="color: #98be65;">\</span>
    --function-name artifacttool <span style="color: #98be65;">\</span>
    --zip-file fileb://$<span style="color: #dcaeea;">ZipFileName</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8a4224" class="outline-3">
<h3 id="orgf8a4224"><a href="#orgf8a4224">Container Image: Run Interactively</a></h3>
<div class="outline-text-3" id="text-orgf8a4224">
<div class="org-src-container">
<pre class="src src-sh">docker run -it --rm --entrypoint bash public.ecr.aws/lambda/python:3.8
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf157f6e" class="outline-2">
<h2 id="orgf157f6e"><a href="#orgf157f6e">Organizations</a></h2>
<div class="outline-text-2" id="text-orgf157f6e">
<div class="org-src-container">
<pre class="src src-sh" id="org2532f07">aws organizations list-roots | jq -r <span style="color: #98be65;">'.Roots[].Id'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb6cf4d" class="outline-2">
<h2 id="orgbb6cf4d"><a href="#orgbb6cf4d">Polly</a></h2>
<div class="outline-text-2" id="text-orgbb6cf4d">
<div class="org-src-container">
<pre class="src src-sh">aws polly synthesize-speech <span style="color: #98be65;">\</span>
    --engine standard <span style="color: #98be65;">\</span>
    --output-format mp3 <span style="color: #98be65;">\</span>
    --voice-id Amy <span style="color: #98be65;">\</span>
    --text <span style="color: #98be65;">"All these cats wear hats."</span> <span style="color: #98be65;">\</span>
    /tmp/speech_standard.mp3 <span style="color: #98be65;">\</span>
    &amp;&amp; afplay /tmp/speech_standard.mp3
</pre>
</div>
</div>

<div id="outline-container-orgc546c6d" class="outline-3">
<h3 id="orgc546c6d"><a href="#orgc546c6d">Say something from insultgenerator.org</a></h3>
<div class="outline-text-3" id="text-orgc546c6d">
<p>
Doesn't work anymore. Get a new insult.
</p>

<div class="org-src-container">
<pre class="src src-sh">aws polly synthesize-speech <span style="color: #98be65;">\</span>
    --output-format mp3 <span style="color: #98be65;">\</span>
    --text <span style="color: #98be65;">"$(curl insultgenerator.org | sed -n '/wrap/,/div/ { s/&lt;[^&gt;]*&gt;//g; p; } ')"</span> <span style="color: #98be65;">\</span>
    --voice-id Justin <span style="color: #98be65;">\</span>
    /tmp/speech.mp3 <span style="color: #98be65;">\</span>
    &amp;&amp; afplay /tmp/speech.mp3
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgab60f32" class="outline-2">
<h2 id="orgab60f32"><a href="#orgab60f32">Reosurce Access Manager (RAM)</a></h2>
<div class="outline-text-2" id="text-orgab60f32">
<p>
This needs to be run against the AWS account that actually owns the shared
resources. E.g. in a LandingZone environment, probably the shared-services
account.
</p>

<div class="org-src-container">
<pre class="src src-sh">aws ram list-resources --resource-owner SELF
</pre>
</div>
</div>
</div>

<div id="outline-container-org55d0fc3" class="outline-2">
<h2 id="org55d0fc3"><a href="#org55d0fc3">Route53</a></h2>
<div class="outline-text-2" id="text-org55d0fc3">
</div>
<div id="outline-container-orgb5761ba" class="outline-3">
<h3 id="orgb5761ba"><a href="#orgb5761ba">Get HostedZoneId from Name</a></h3>
<div class="outline-text-3" id="text-orgb5761ba">
<div class="org-src-container">
<pre class="src src-sh" id="org2f7a4d7">aws route53 list-hosted-zones <span style="color: #98be65;">\</span>
    | jq -r --arg name $<span style="color: #dcaeea;">HostedZoneName</span> <span style="color: #98be65;">\</span>
         <span style="color: #98be65;">'.HostedZones[] | select(.Name == $name + ".") | .Id'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ace9e4" class="outline-3">
<h3 id="org6ace9e4"><a href="#org6ace9e4">List Records for a HostedZone</a></h3>
<div class="outline-text-3" id="text-org6ace9e4">
<p>
Records containing a certain string:
</p>

<div class="org-src-container">
<pre class="src src-sh">aws route53 list-resource-record-sets <span style="color: #98be65;">\</span>
    --hosted-zone-id $<span style="color: #dcaeea;">HostedZoneId</span> <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.ResourceRecordSets[]</span>
<span style="color: #98be65;">          | select(.Name | contains("daily"))</span>
<span style="color: #98be65;">          | .Name'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga69987c" class="outline-2">
<h2 id="orga69987c"><a href="#orga69987c">SecretsManager</a></h2>
<div class="outline-text-2" id="text-orga69987c">
</div>
<div id="outline-container-orgfb0ed36" class="outline-3">
<h3 id="orgfb0ed36"><a href="#orgfb0ed36">List Secrets</a></h3>
<div class="outline-text-3" id="text-orgfb0ed36">
<div class="org-src-container">
<pre class="src src-sh">aws secretsmanager list-secrets
</pre>
</div>
</div>
</div>

<div id="outline-container-org588c094" class="outline-3">
<h3 id="org588c094"><a href="#org588c094">Get Secret</a></h3>
<div class="outline-text-3" id="text-org588c094">
<div class="org-src-container">
<pre class="src src-sh">aws secretsmanager get-secret-value <span style="color: #98be65;">\</span>
    --secret-id $<span style="color: #dcaeea;">SecretName</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.SecretString'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4a3013" class="outline-3">
<h3 id="orgc4a3013"><a href="#orgc4a3013">Create Secret</a></h3>
<div class="outline-text-3" id="text-orgc4a3013">
<div class="org-src-container">
<pre class="src src-sh">aws secretsmanager create-secret <span style="color: #98be65;">\</span>
    --name $<span style="color: #dcaeea;">SecretName</span> <span style="color: #98be65;">\</span>
    --secret-string $<span style="color: #dcaeea;">SecretValue</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8fce1e7" class="outline-2">
<h2 id="org8fce1e7"><a href="#org8fce1e7">ServiceCatalog</a></h2>
<div class="outline-text-2" id="text-org8fce1e7">
</div>
<div id="outline-container-orgec228b4" class="outline-3">
<h3 id="orgec228b4"><a href="#orgec228b4">Get Product IDs</a></h3>
<div class="outline-text-3" id="text-orgec228b4">
<div class="org-src-container">
<pre class="src src-sh">aws --profile main servicecatalog search-products-as-admin
</pre>
</div>
</div>
</div>

<div id="outline-container-org79414b7" class="outline-3">
<h3 id="org79414b7"><a href="#org79414b7">Launch Product</a></h3>
<div class="outline-text-3" id="text-org79414b7">
<p>
Note that user, even Admin user, must be added to the Portfolio users/groups.
You can do this with <code>aws servicecatalog associate-principal-with-portfolio</code>
</p>
</div>
</div>
</div>

<div id="outline-container-orgdea666c" class="outline-2">
<h2 id="orgdea666c"><a href="#orgdea666c">Service Quotas</a></h2>
<div class="outline-text-2" id="text-orgdea666c">
</div>
<div id="outline-container-org90b917a" class="outline-3">
<h3 id="org90b917a"><a href="#org90b917a">Get Quota</a></h3>
<div class="outline-text-3" id="text-org90b917a">
<div class="org-src-container">
<pre class="src src-sh">aws service-quotas list-service-quotas <span style="color: #98be65;">\</span>
    --service-code firehose <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.Quotas[] | {QuotaName, Value}'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9305da2" class="outline-3">
<h3 id="org9305da2"><a href="#org9305da2">Get Default Quota</a></h3>
<div class="outline-text-3" id="text-org9305da2">
<div class="org-src-container">
<pre class="src src-sh">aws service-quotas get-aws-default-service-quota <span style="color: #98be65;">\</span>
    --service-code firehose <span style="color: #98be65;">\</span>
    --quota-code $<span style="color: #dcaeea;">QuotaCode</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1f03d16" class="outline-2">
<h2 id="org1f03d16"><a href="#org1f03d16">S3</a></h2>
<div class="outline-text-2" id="text-org1f03d16">
</div>
<div id="outline-container-org32286c5" class="outline-3">
<h3 id="org32286c5"><a href="#org32286c5">Canonical ID</a></h3>
<div class="outline-text-3" id="text-org32286c5">
<div class="org-src-container">
<pre class="src src-sh">aws s3api get-bucket-acl --bucket $<span style="color: #dcaeea;">BucketName</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e8b212" class="outline-3">
<h3 id="org2e8b212"><a href="#org2e8b212">List objects in bucket</a></h3>
<div class="outline-text-3" id="text-org2e8b212">
<p>
All objects
</p>

<div class="org-src-container">
<pre class="src src-sh">aws s3api list-objects-v2 <span style="color: #98be65;">\</span>
    --bucket $<span style="color: #dcaeea;">BucketName</span> <span style="color: #98be65;">\</span>
    | jq <span style="color: #98be65;">'.Contents[]'</span>
</pre>
</div>

<p>
10 most recent objects. AWS has no way of doing this filtering server-side,
so you need to request all objects and then sort them.
</p>

<div class="org-src-container">
<pre class="src src-sh">aws s3api list-objects-v2 <span style="color: #98be65;">\</span>
    --bucket $<span style="color: #dcaeea;">BucketName</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Contents | sort_by(.LastModified) | reverse | first | .Key'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org22fdcec" class="outline-3">
<h3 id="org22fdcec"><a href="#org22fdcec">Get Object</a></h3>
<div class="outline-text-3" id="text-org22fdcec">
<div class="org-src-container">
<pre class="src src-sh">aws s3api get-object <span style="color: #98be65;">\</span>
    --bucket $<span style="color: #dcaeea;">BucketName</span> <span style="color: #98be65;">\</span>
    --key $<span style="color: #dcaeea;">Key</span> ./foo
</pre>
</div>
</div>
</div>

<div id="outline-container-org4cd11b1" class="outline-3">
<h3 id="org4cd11b1"><a href="#org4cd11b1">Get bucket policy</a></h3>
<div class="outline-text-3" id="text-org4cd11b1">
<div class="org-src-container">
<pre class="src src-sh">aws s3api get-bucket-policy --bucket $<span style="color: #dcaeea;">BucketName</span> <span style="color: #98be65;">\</span>
    | jq -r <span style="color: #98be65;">'.Policy'</span> | jq
</pre>
</div>
</div>
</div>

<div id="outline-container-org9db094d" class="outline-3">
<h3 id="org9db094d"><a href="#org9db094d">Delete Buckets with Name</a></h3>
<div class="outline-text-3" id="text-org9db094d">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">buckets</span>=$(aws s3api list-buckets | jq -r .Buckets[].Name  | grep $<span style="color: #dcaeea;">Name</span>)
<span style="color: #51afef;">for</span> bucket<span style="color: #51afef;"> in</span> $<span style="color: #dcaeea;">buckets</span>; <span style="color: #51afef;">do</span>
    aws s3 rb s3://$<span style="color: #dcaeea;">bucket</span>
<span style="color: #51afef;">done</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org763ada6" class="outline-2">
<h2 id="org763ada6"><a href="#org763ada6">SNS</a></h2>
<div class="outline-text-2" id="text-org763ada6">
</div>
<div id="outline-container-org497ba1a" class="outline-3">
<h3 id="org497ba1a"><a href="#org497ba1a">SNS topics</a></h3>
<div class="outline-text-3" id="text-org497ba1a">
<div class="org-src-container">
<pre class="src src-sh">aws sns list-topics | jq <span style="color: #98be65;">'.Topics[] | .TopicArn'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4bd4d2a" class="outline-2">
<h2 id="org4bd4d2a"><a href="#org4bd4d2a">SQS</a></h2>
<div class="outline-text-2" id="text-org4bd4d2a">
</div>
<div id="outline-container-orga7bdbc7" class="outline-3">
<h3 id="orga7bdbc7"><a href="#orga7bdbc7">List Queues</a></h3>
<div class="outline-text-3" id="text-orga7bdbc7">
<div class="org-src-container">
<pre class="src src-sh">aws sqs list-queues | jq <span style="color: #98be65;">'.QueueUrls[]'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1cb379f" class="outline-2">
<h2 id="org1cb379f"><a href="#org1cb379f">SSO</a></h2>
<div class="outline-text-2" id="text-org1cb379f">
</div>
<div id="outline-container-org88d92c0" class="outline-3">
<h3 id="org88d92c0"><a href="#org88d92c0">Token</a></h3>
<div class="outline-text-3" id="text-org88d92c0">
<p>
TODO: Look up token file programatically
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org931297e"><span style="color: #dcaeea;">token</span>=$(cat $<span style="color: #dcaeea;">tokenFile</span> | jq -r <span style="color: #98be65;">'.accessToken'</span>)
<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">token</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org820fb98" class="outline-3">
<h3 id="org820fb98"><a href="#org820fb98">List Accounts I Can Access</a></h3>
<div class="outline-text-3" id="text-org820fb98">
<div class="org-src-container">
<pre class="src src-sh">aws  sso list-accounts <span style="color: #98be65;">\</span>
     --access-token $<span style="color: #dcaeea;">SsoToken</span> <span style="color: #98be65;">\</span>
    | jq -c <span style="color: #98be65;">'.accountList[] | {accountName, accountId}'</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
