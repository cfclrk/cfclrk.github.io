<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Org Babel</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/main.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id="navbar" class="cf">
  <ul class="cf">
    <li class="fl">
      <a href="/">cfclrk</a>
    </li>
    <li class="fr">
      <a href="/articles/home.html">Articles</a>
    </li>
    <li class="fr">
      <a href="/notes/home.html">Notes</a>
    </li>
	<li class="fr">
      <a href="/cloudformation/home.html">CloudFormation</a>
    </li>
  </ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Org Babel</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org29f76e8">Print Error of Code Block</a>
<ul>
<li><a href="#org08ae3be">Shell</a></li>
<li><a href="#org27b8f9c">Python</a></li>
</ul>
</li>
<li><a href="#org767e6e1">Emacs Lisp</a></li>
<li><a href="#orga28cf6e">TRAMP</a>
<ul>
<li><a href="#org5a39968">Single Hop</a></li>
<li><a href="#orga2d97cd">Double-Hop (Use a Bastion)</a></li>
</ul>
</li>
<li><a href="#org29b35d8">Copy File to Remote Machine</a></li>
<li><a href="#orgbcad706">IP Address Variable</a></li>
</ul>
</div>
</nav>

<div id="outline-container-org29f76e8" class="outline-2">
<h2 id="org29f76e8"><a href="#org29f76e8">Print Error of Code Block</a></h2>
<div class="outline-text-2" id="text-org29f76e8">
<p>
Relevant SO questions:
</p>

<ul class="org-ul">
<li><a href="https://emacs.stackexchange.com/questions/60649/show-compilation-errors-in-results-code-blocks">Show compilation errors in “#+RESULTS” code blocks</a></li>
<li><a href="https://emacs.stackexchange.com/questions/48835/help-me-avoid-true-in-org-babel-bash-statements/48842#48842">Help me avoid “|| true” in org babel bash statements</a></li>
</ul>
</div>

<div id="outline-container-org08ae3be" class="outline-3">
<h3 id="org08ae3be"><a href="#org08ae3be">Shell</a></h3>
<div class="outline-text-3" id="text-org08ae3be">
<div class="org-src-container">
<pre class="src src-bash">ls --foo
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
ls: illegal option -- -
usage: ls [-@ABCFGHLOPRSTUWabcdefghiklmnopqrstuwx1%] [file ...]
</pre>


<p>
Doesn't work:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"hi"</span>
<span style="color: #51afef;">exit</span> 1
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c678dd;">set</span> -u
<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">foo</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org27b8f9c" class="outline-3">
<h3 id="org27b8f9c"><a href="#org27b8f9c">Python</a></h3>
<div class="outline-text-3" id="text-org27b8f9c">
<div class="org-src-container">
<pre class="src src-sh">python -c <span style="color: #98be65;">'bar=b"&#1054;&#1060;&#1048;&#1057;"''</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org767e6e1" class="outline-2">
<h2 id="org767e6e1"><a href="#org767e6e1">Emacs Lisp</a></h2>
<div class="outline-text-2" id="text-org767e6e1">
<p>
To print data structure, use <code>:results value pp</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7e97669">'<span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"DeploymentName"</span> <span style="color: #98be65;">"webserver"</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #98be65;">"KeyName"</span> <span style="color: #98be65;">"cfc"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">Params
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
(("DeploymentName" "webserver")
 ("KeyName" "cfc"))
</pre>
</div>
</div>

<div id="outline-container-orga28cf6e" class="outline-2">
<h2 id="orga28cf6e"><a href="#orga28cf6e">TRAMP</a></h2>
<div class="outline-text-2" id="text-orga28cf6e">
</div>
<div id="outline-container-org5a39968" class="outline-3">
<h3 id="org5a39968"><a href="#org5a39968">Single Hop</a></h3>
<div class="outline-text-3" id="text-org5a39968">
<pre class="example" id="orgf53a9ed">
:dir /ssh:ec2-user@1.2.3.4:/
</pre>
</div>
</div>

<div id="outline-container-orga2d97cd" class="outline-3">
<h3 id="orga2d97cd"><a href="#orga2d97cd">Double-Hop (Use a Bastion)</a></h3>
<div class="outline-text-3" id="text-orga2d97cd">
<pre class="example" id="orgd9996f0">
:dir /ssh:ec2-user@1.2.3.4|ssh:ec2-user@10.192.1.2:/
</pre>
</div>
</div>
</div>

<div id="outline-container-org29b35d8" class="outline-2">
<h2 id="org29b35d8"><a href="#org29b35d8">Copy File to Remote Machine</a></h2>
<div class="outline-text-2" id="text-org29b35d8">
<p>
This leverages my <code>host</code> function.
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #51afef;">(</span>copy-file MyFile <span style="color: #c678dd;">(</span>host <span style="color: #98be65;">"ec2-user"</span> <span style="color: #98be65;">"/tmp/my_file.txt"</span> 'sudo<span style="color: #c678dd;">)</span> t<span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcad706" class="outline-2">
<h2 id="orgbcad706"><a href="#orgbcad706">IP Address Variable</a></h2>
<div class="outline-text-2" id="text-orgbcad706">
<p>
Because you don't want to hard-code IP addresses in your source blocks like
some kind of animal!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">host</span> <span style="color: #c678dd;">(</span>user ip path <span style="color: #ECBE7B;">&amp;optional</span> sudo<span style="color: #c678dd;">)</span>
  <span style="color: #83898d;">"Return a TRAMP string for SSHing to a remote host.</span>
<span style="color: #83898d;">USER is a user name on the remote host IP. PATH is the path on</span>
<span style="color: #83898d;">the remote host at which to execute the source block. If SUDO is</span>
<span style="color: #83898d;">non-nil, use sudo on the remote host."</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> sudo
      <span style="color: #98be65;">(</span><span style="color: #51afef;">s-lex-format</span> <span style="color: #98be65;">"/ssh:${user}@${ip}|sudo:${ip}:${path}"</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">s-lex-format</span> <span style="color: #98be65;">"/ssh:${user}@${ip}:${path}"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
Then set variables at the top of a file, and use something like:
</p>

<pre class="example" id="orgc88aace">
#+begin_src bash :dir (host (getenv "HOST") (getenv "USER") "/home/ec2-user")
  pwd
#+end_src
</pre>
</div>
</div>
</div>
</body>
</html>
