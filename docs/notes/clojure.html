<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clojure</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/main.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id="navbar" class="cf">
  <ul class="cf">
    <li class="fl">
      <a href="/">cfclrk</a>
    </li>
    <li class="fr">
      <a href="/articles/home.html">Articles</a>
    </li>
    <li class="fr">
      <a href="/notes/home.html">Notes</a>
    </li>
	<li class="fr">
      <a href="/cloudformation/home.html">CloudFormation</a>
    </li>
  </ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Clojure</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org1ec3ca0">Installation</a></li>
<li><a href="#orgdecc67a">clj vs clojure</a></li>
<li><a href="#org6e70f25">Cmd Execution and REPL</a></li>
<li><a href="#org3385fbb">Project Creation</a>
<ul>
<li><a href="#org5f9f88c">Minimal</a></li>
<li><a href="#orgf7f553c">Leiningen</a></li>
<li><a href="#orge34443f">deps-new</a></li>
</ul>
</li>
<li><a href="#org96ab6bc">Emacs Cider</a>
<ul>
<li><a href="#org4f02911">Tips</a></li>
<li><a href="#org10e514e">Doc</a></li>
</ul>
</li>
<li><a href="#org106e00f">Testing</a>
<ul>
<li><a href="#org8c4169e">Run all tests in namespace</a></li>
<li><a href="#org8a6790f">Run a single test</a></li>
</ul>
</li>
<li><a href="#orgea9bdd7">Symbols vs Keywords</a></li>
<li><a href="#orgaff9517">How to (+ 1 2 3)</a></li>
<li><a href="#orgf4cf461">core.async</a></li>
</ul>
</div>
</nav>

<div id="outline-container-org1ec3ca0" class="outline-2">
<h2 id="org1ec3ca0"><a href="#org1ec3ca0">Installation</a></h2>
<div class="outline-text-2" id="text-org1ec3ca0">
<p>
The clojure site <a href="https://clojure.org/guides/getting_started#_clojure_installer_and_cli_tools">suggests</a> using the following, but <code>brew install clojure</code> also
works just fine.
</p>

<div class="org-src-container">
<pre class="src src-sh">brew install clojure/tools/clojure
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdecc67a" class="outline-2">
<h2 id="orgdecc67a"><a href="#orgdecc67a">clj vs clojure</a></h2>
<div class="outline-text-2" id="text-orgdecc67a">
<p>
<code>clj</code> is just a program that wraps <code>clojure</code> with <code>readline</code> support.
</p>

<div class="org-src-container">
<pre class="src src-bash">find /usr/local/Cellar/clojure -name clj <span style="color: #98be65;">\</span>
    | sed -n <span style="color: #98be65;">'2 p'</span> <span style="color: #98be65;">\</span>
    | xargs cat <span style="color: #98be65;">\</span>
    | grep exec
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
exec rlwrap -r -q '\"' -b "(){}[],^%#@\";:'" "$bin_dir/clojure" "$@"
</pre>


<p>
<code>readline</code> provides support for editing a command in the terminal (e.g. using
arrow keys and <code>C-a</code> <code>C-e</code> <code>C-f</code> <code>C-b</code> for movement, and stuff like that.
</p>

<p>
So, <code>clj</code> just provides better interactivity in the terminal REPL.
</p>
</div>
</div>

<div id="outline-container-org6e70f25" class="outline-2">
<h2 id="org6e70f25"><a href="#org6e70f25">Cmd Execution and REPL</a></h2>
<div class="outline-text-2" id="text-org6e70f25">
<p>
Call a single function
</p>

<div class="org-src-container">
<pre class="src src-sh">clj -X $<span style="color: #dcaeea;">nsname</span>/$<span style="color: #dcaeea;">funcname</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
Hello world, the time is 10:00 AM
</pre>


<p>
Start a REPL that I can attach to from Emacs.
</p>

<div class="org-src-container">
<pre class="src src-sh">clj -Sdeps <span style="color: #98be65;">'{:deps {cider/cider-nrepl {:mvn/version "RELEASE"}}}'</span> <span style="color: #98be65;">\</span>
    -m nrepl.cmdline <span style="color: #98be65;">\</span>
    --middleware <span style="color: #98be65;">"[cider.nrepl/cider-middleware]"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3385fbb" class="outline-2">
<h2 id="org3385fbb"><a href="#org3385fbb">Project Creation</a></h2>
<div class="outline-text-2" id="text-org3385fbb">
</div>
<div id="outline-container-org5f9f88c" class="outline-3">
<h3 id="org5f9f88c"><a href="#org5f9f88c">Minimal</a></h3>
<div class="outline-text-3" id="text-org5f9f88c">
<p>
All you need is a project directory with a <code>deps.edn</code> and a <code>src/foo.clj</code>.
However it should be namespaced properly (TODO: work on this).
</p>

<div class="org-src-container">
<pre class="src src-sh">touch $<span style="color: #dcaeea;">d</span>/deps.edn $<span style="color: #dcaeea;">d</span>/src/core.clj
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"{:deps {org.clojure/clojure {:mvn/version \"RELEASE\"}}}"</span> &gt; $<span style="color: #dcaeea;">d</span>/deps.edn
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"(ns core) (defn -main [] (println \"hello world\"))"</span> &gt;&gt; src/core.clj
clj -m core
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7f553c" class="outline-3">
<h3 id="orgf7f553c"><a href="#orgf7f553c">Leiningen</a></h3>
<div class="outline-text-3" id="text-orgf7f553c">
<div class="org-src-container">
<pre class="src src-sh">lein new app cfclrk/$<span style="color: #dcaeea;">projectName</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge34443f" class="outline-3">
<h3 id="orge34443f"><a href="#orge34443f">deps-new</a></h3>
<div class="outline-text-3" id="text-orge34443f">
<p>
First, make sure <a href="https://github.com/seancorfield/deps-new">deps-new</a> is installed:
</p>

<div class="org-src-container">
<pre class="src src-sh">clojure -Ttools install <span style="color: #98be65;">\</span>
    io.github.seancorfield/deps-new <span style="color: #98be65;">\</span>
    <span style="color: #98be65;">'{:git/tag "v0.4.9"}'</span> :as new
</pre>
</div>

<p>
Create a new app:
</p>

<div class="org-src-container">
<pre class="src src-sh">clojure -Tnew app :name cfclrk/$<span style="color: #dcaeea;">projectName</span>
</pre>
</div>

<p>
Create a new lib:
</p>

<div class="org-src-container">
<pre class="src src-sh">clojure -Tnew lib :name cfclrk/$<span style="color: #dcaeea;">projectName</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org96ab6bc" class="outline-2">
<h2 id="org96ab6bc"><a href="#org96ab6bc">Emacs Cider</a></h2>
<div class="outline-text-2" id="text-org96ab6bc">
<p>
Basic workflow is described <a href="https://docs.cider.mx/cider/usage/cider_mode.html#basic-workflow">in the cider docs here</a>.
</p>

<ul class="org-ul">
<li>Open a file in the project</li>
<li><code>M-x cider-jack-in</code></li>
<li>Load a project file using <code>C-c C-k</code> (<code>cider-load-buffer</code>)</li>
<li>In the <code>*cider-repl</code> buffer, you know call the fully-qualified functions in
that file.
<ul class="org-ul">
<li>Or, <code>(in-ns 'the.ns.name)</code> to call functions in that file without
namespace qualification.</li>
<li>Then also <code>(use 'clojure.core)</code> and <code>(use 'clojure.repl)</code>'</li>
</ul></li>
<li>Edit a function, and <code>C-c C-e</code> on that function to reload it.</li>
</ul>
</div>

<div id="outline-container-org4f02911" class="outline-3">
<h3 id="org4f02911"><a href="#org4f02911">Tips</a></h3>
<div class="outline-text-3" id="text-org4f02911">
<ul class="org-ul">
<li>From source file, <code>C-u C-c C-z</code> to jump to cider buffer already namespaced
to the source file.</li>
<li>Quit a long-running eval with <code>C-c C-b</code> (<code>cider-interrupt</code>).</li>
</ul>
</div>
</div>

<div id="outline-container-org10e514e" class="outline-3">
<h3 id="org10e514e"><a href="#org10e514e">Doc</a></h3>
<div class="outline-text-3" id="text-org10e514e">
<p>
Function doc: <code>C-c C-d C-d</code> (<code>cider-doc</code>)
</p>
</div>
</div>
</div>

<div id="outline-container-org106e00f" class="outline-2">
<h2 id="org106e00f"><a href="#org106e00f">Testing</a></h2>
<div class="outline-text-2" id="text-org106e00f">
<p>
Use test-runner, which handles test discovery and running tests.
<a href="https://github.com/cognitect-labs/test-runner">https://github.com/cognitect-labs/test-runner</a>
</p>
</div>

<div id="outline-container-org8c4169e" class="outline-3">
<h3 id="org8c4169e"><a href="#org8c4169e">Run all tests in namespace</a></h3>
<div class="outline-text-3" id="text-org8c4169e">
<div class="org-src-container">
<pre class="src src-sh">clj -A:test -n cfclrk.sicp-test
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a6790f" class="outline-3">
<h3 id="org8a6790f"><a href="#org8a6790f">Run a single test</a></h3>
<div class="outline-text-3" id="text-org8a6790f">
<div class="org-src-container">
<pre class="src src-sh">clj -A:test -v cfclrk.sicp-test/a-test
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgea9bdd7" class="outline-2">
<h2 id="orgea9bdd7"><a href="#orgea9bdd7">Symbols vs Keywords</a></h2>
<div class="outline-text-2" id="text-orgea9bdd7">
<p>
What's the difference between a quoted symbol and a keyword?
</p>

<p>
Excerpt from "Clojure in Action, Second Edition" by Amit Rathore Francis
Avila:
</p>

<blockquote>
<p>
Essetially what's happening when you quote a symbol is you’re treating the
symbol as data and not code. In practice you’ll almost never quote symbols to
use them as data because Clojure has a special type specifically for this use
case: the keyword. A keyword is sort of like an autoquoted symbol: keywords
never reference some other value and always evaluate to themselves. Keyword
syntax is almost like symbol syntax, except keywords always begin with a
colon.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgaff9517" class="outline-2">
<h2 id="orgaff9517"><a href="#orgaff9517">How to (+ 1 2 3)</a></h2>
<div class="outline-text-2" id="text-orgaff9517">
<p>
A few ways to add 1, 2, and 3.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>+ 1 2 3<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
6
</pre>


<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>apply + <span style="color: #c678dd;">[</span>1 2 3<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
6
</pre>


<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>reduce + <span style="color: #c678dd;">[</span>1 2 3<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
6
</pre>


<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>reduce <span style="color: #c678dd;">(</span><span style="color: #51afef;">fn</span> <span style="color: #98be65;">[</span>x y<span style="color: #98be65;">]</span> <span style="color: #98be65;">(</span>+ x y<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">[</span>1 2 3<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
6
</pre>
</div>
</div>

<div id="outline-container-orgf4cf461" class="outline-2">
<h2 id="orgf4cf461"><a href="#orgf4cf461">core.async</a></h2>
<div class="outline-text-2" id="text-orgf4cf461">
<p>
There are some great examples from O'Reilly <a href="https://resources.oreilly.com/examples/0636920041474/">here</a>, which is supplemental
content for their excellent video course <a href="https://learning.oreilly.com/videos/communicating-sequential-processes/9781771374293/">Communicating Sequential Processes
with core.async</a>.
</p>
</div>
</div>
</div>
</body>
</html>
