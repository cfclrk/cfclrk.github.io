<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clojure</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/main.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id="navbar" class="cf">
  <ul class="cf">
    <li class="fl">
      <a href="/">cfclrk</a>
    </li>
    <li class="fr">
      <a href="/articles/home.html">Articles</a>
    </li>
    <li class="fr">
      <a href="/notes/home.html">Notes</a>
    </li>
	<li class="fr">
      <a href="/cloudformation/home.html">CloudFormation</a>
    </li>
  </ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Clojure</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge5d8209">Installation</a></li>
<li><a href="#orgd703106">clj vs clojure</a></li>
<li><a href="#org70c1485">Cmd Execution and REPL</a></li>
<li><a href="#orgc264fe2">Project Creation</a>
<ul>
<li><a href="#org60a1998">Minimal</a></li>
<li><a href="#org96e3037">Using deps-new</a></li>
</ul>
</li>
<li><a href="#orgf048057">Emacs Cider</a>
<ul>
<li><a href="#org53e30ee">Tips</a></li>
<li><a href="#orgcfad32c">Doc</a></li>
</ul>
</li>
<li><a href="#orge6a1db3">Testing</a>
<ul>
<li><a href="#org2e14185">Run all tests in namespace</a></li>
<li><a href="#org829c15b">Run a single test</a></li>
</ul>
</li>
<li><a href="#org288a348">Symbols vs Keywords</a></li>
<li><a href="#org71a8376">How to (+ 1 2)</a></li>
<li><a href="#orgcfa36c4">core.async</a></li>
</ul>
</div>
</nav>

<div id="outline-container-orge5d8209" class="outline-2">
<h2 id="orge5d8209"><a href="#orge5d8209">Installation</a></h2>
<div class="outline-text-2" id="text-orge5d8209">
<div class="org-src-container">
<pre class="src src-sh">brew install clojure
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd703106" class="outline-2">
<h2 id="orgd703106"><a href="#orgd703106">clj vs clojure</a></h2>
<div class="outline-text-2" id="text-orgd703106">
<p>
<code>clj</code> is just a program that wraps <code>clojure</code> with <code>readline</code> support.
</p>

<div class="org-src-container">
<pre class="src src-bash">find /usr/local/Cellar/clojure -name clj <span style="color: #98be65;">\</span>
    | sed -n <span style="color: #98be65;">'2 p'</span> <span style="color: #98be65;">\</span>
    | xargs cat <span style="color: #98be65;">\</span>
    | grep exec
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
exec rlwrap -r -q '\"' -b "(){}[],^%#@\";:'" "$bin_dir/clojure" "$@"
</pre>


<p>
<code>readline</code> provides support for editing a command in the terminal (e.g. using
arrow keys and <code>C-a</code> <code>C-e</code> <code>C-f</code> <code>C-b</code> for movement, and stuff like that.
</p>

<p>
So, <code>clj</code> just provides better interactivity in the terminal REPL.
</p>
</div>
</div>

<div id="outline-container-org70c1485" class="outline-2">
<h2 id="org70c1485"><a href="#org70c1485">Cmd Execution and REPL</a></h2>
<div class="outline-text-2" id="text-org70c1485">
<p>
Call a single function
</p>

<div class="org-src-container">
<pre class="src src-sh">clj -X $<span style="color: #dcaeea;">nsname</span>/$<span style="color: #dcaeea;">funcname</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
Hello world, the time is 10:00 AM
</pre>


<p>
Start a REPL that I can attach to from Emacs.
</p>

<div class="org-src-container">
<pre class="src src-sh">clj -Sdeps <span style="color: #98be65;">'{:deps {cider/cider-nrepl {:mvn/version "RELEASE"}}}'</span> <span style="color: #98be65;">\</span>
    -m nrepl.cmdline <span style="color: #98be65;">\</span>
    --middleware <span style="color: #98be65;">"[cider.nrepl/cider-middleware]"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc264fe2" class="outline-2">
<h2 id="orgc264fe2"><a href="#orgc264fe2">Project Creation</a></h2>
<div class="outline-text-2" id="text-orgc264fe2">
</div>
<div id="outline-container-org60a1998" class="outline-3">
<h3 id="org60a1998"><a href="#org60a1998">Minimal</a></h3>
<div class="outline-text-3" id="text-org60a1998">
<p>
All you need is a project directory with a <code>deps.edn</code> and a <code>src/foo.clj</code>.
However it should be namespaced properly (TODO: work on this).
</p>

<div class="org-src-container">
<pre class="src src-sh">touch $<span style="color: #dcaeea;">d</span>/deps.edn $<span style="color: #dcaeea;">d</span>/src/core.clj
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"{:deps {org.clojure/clojure {:mvn/version \"RELEASE\"}}}"</span> &gt; $<span style="color: #dcaeea;">d</span>/deps.edn
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"(ns core) (defn -main [] (println \"hello world\"))"</span> &gt;&gt; src/core.clj
clj -m core
</pre>
</div>
</div>
</div>

<div id="outline-container-org96e3037" class="outline-3">
<h3 id="org96e3037"><a href="#org96e3037">Using deps-new</a></h3>
<div class="outline-text-3" id="text-org96e3037">
<p>
First, make sure <a href="https://github.com/seancorfield/deps-new">deps-new</a> is installed:
</p>

<div class="org-src-container">
<pre class="src src-sh">clojure -Ttools install <span style="color: #98be65;">\</span>
    io.github.seancorfield/deps-new <span style="color: #98be65;">\</span>
    <span style="color: #98be65;">'{:git/tag "v0.4.9"}'</span> :as new
</pre>
</div>

<p>
Create a new app:
</p>

<div class="org-src-container">
<pre class="src src-sh">clojure -Tnew app :name cfclrk/$<span style="color: #dcaeea;">projectName</span>
</pre>
</div>

<p>
Create a new lib:
</p>

<div class="org-src-container">
<pre class="src src-sh">clojure -Tnew lib :name cfclrk/$<span style="color: #dcaeea;">projectName</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf048057" class="outline-2">
<h2 id="orgf048057"><a href="#orgf048057">Emacs Cider</a></h2>
<div class="outline-text-2" id="text-orgf048057">
<p>
Basic workflow is described <a href="https://docs.cider.mx/cider/usage/cider_mode.html#basic-workflow">in the cider docs here</a>.
</p>

<ul class="org-ul">
<li>Open a file in the project</li>
<li><code>M-x cider-jack-in</code></li>
<li>Load a project file using <code>C-c C-k</code> (<code>cider-load-buffer</code>)</li>
<li>In the <code>*cider-repl</code> buffer, you know call the fully-qualified functions in
that file. Or, <code>(in-ns &lt;ns-name&gt;)</code> to call functions in that file without
namespace qualification.</li>
<li>Edit a function, and <code>C-c C-e</code> on that function to reload it.</li>
</ul>
</div>

<div id="outline-container-org53e30ee" class="outline-3">
<h3 id="org53e30ee"><a href="#org53e30ee">Tips</a></h3>
<div class="outline-text-3" id="text-org53e30ee">
<ul class="org-ul">
<li>From source file, <code>C-u C-c C-z</code> to jump to cider buffer already namespaced
to the source file.</li>
<li>Quit a long-running eval with <code>C-c C-b</code> (<code>cider-interrupt</code>).</li>
</ul>
</div>
</div>

<div id="outline-container-orgcfad32c" class="outline-3">
<h3 id="orgcfad32c"><a href="#orgcfad32c">Doc</a></h3>
<div class="outline-text-3" id="text-orgcfad32c">
<p>
Function doc: <code>C-c C-d C-d</code> (<code>cider-doc</code>)
</p>
</div>
</div>
</div>

<div id="outline-container-orge6a1db3" class="outline-2">
<h2 id="orge6a1db3"><a href="#orge6a1db3">Testing</a></h2>
<div class="outline-text-2" id="text-orge6a1db3">
<p>
Use test-runner, which handles test discovery and running tests.
<a href="https://github.com/cognitect-labs/test-runner">https://github.com/cognitect-labs/test-runner</a>
</p>
</div>

<div id="outline-container-org2e14185" class="outline-3">
<h3 id="org2e14185"><a href="#org2e14185">Run all tests in namespace</a></h3>
<div class="outline-text-3" id="text-org2e14185">
<div class="org-src-container">
<pre class="src src-sh">clj -A:test -n cfclrk.sicp-test
</pre>
</div>
</div>
</div>

<div id="outline-container-org829c15b" class="outline-3">
<h3 id="org829c15b"><a href="#org829c15b">Run a single test</a></h3>
<div class="outline-text-3" id="text-org829c15b">
<div class="org-src-container">
<pre class="src src-sh">clj -A:test -v cfclrk.sicp-test/a-test
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org288a348" class="outline-2">
<h2 id="org288a348"><a href="#org288a348">Symbols vs Keywords</a></h2>
<div class="outline-text-2" id="text-org288a348">
<p>
What's the difference between a symbol and a keyword?
</p>

<p>
Excerpt from "Clojure in Action, Second Edition" by Amit Rathore Francis
Avila:
</p>

<blockquote>
<p>
Essetially what's happening when you quote a symbol is you’re treating the
symbol as data and not code. In practice you’ll almost never quote symbols to
use them as data because Clojure has a special type specifically for this use
case: the keyword. A keyword is sort of like an autoquoted symbol: keywords
never reference some other value and always evaluate to themselves. Keyword
syntax is almost like symbol syntax, except keywords always begin with a
colon.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org71a8376" class="outline-2">
<h2 id="org71a8376"><a href="#org71a8376">How to (+ 1 2)</a></h2>
<div class="outline-text-2" id="text-org71a8376">
<p>
A few ways to add 1 and 2, in increasing complexity.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>+ 1 2<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
3
</pre>


<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>apply + <span style="color: #c678dd;">[</span>1 2<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
3
</pre>


<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>reduce + <span style="color: #c678dd;">[</span>1 2<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
3
</pre>


<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #51afef;">(</span>reduce <span style="color: #c678dd;">(</span><span style="color: #51afef;">fn</span> <span style="color: #98be65;">[</span>acc i<span style="color: #98be65;">]</span> <span style="color: #98be65;">(</span>+ acc i<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">[</span>1 2<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="results">#+RESULTS:</div><pre class="example">
3
</pre>
</div>
</div>

<div id="outline-container-orgcfa36c4" class="outline-2">
<h2 id="orgcfa36c4"><a href="#orgcfa36c4">core.async</a></h2>
<div class="outline-text-2" id="text-orgcfa36c4">
<p>
There are some great examples from O'Reilly <a href="https://resources.oreilly.com/examples/0636920041474/">here</a>, which is supplemental
content for their excellent video course <a href="https://learning.oreilly.com/videos/communicating-sequential-processes/9781771374293/">Communicating Sequential Processes
with core.async</a>.
</p>
</div>
</div>
</div>
</body>
</html>
