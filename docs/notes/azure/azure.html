<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Random Notes</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/main.css" />
</head>
<body>
<div id="preamble" class="status">
<nav id="navbar" class="cf">
  <ul class="cf">
    <li class="fl">
      <a href="/">cfclrk</a>
    </li>
    <li class="fr">
      <a href="/articles/home.html">Articles</a>
    </li>
    <li class="fr">
      <a href="/notes/home.html">Notes</a>
    </li>
	<li class="fr">
      <a href="/cloudformation/home.html">CloudFormation</a>
    </li>
  </ul>
</nav>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Random Notes</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orged83908">Managed Service Identities</a></li>
<li><a href="#org4e21127">Resource Providers</a></li>
<li><a href="#org0f606c4">RBAC</a>
<ul>
<li><a href="#org727a35f">Security Principal</a></li>
<li><a href="#org5fa37e1">Role</a></li>
<li><a href="#org1287e75">Scope</a></li>
</ul>
</li>
<li><a href="#org9686940">Subscription Model</a>
<ul>
<li><a href="#org5eb49cd">Tenant</a></li>
<li><a href="#org7f1b33c">User</a></li>
<li><a href="#orgb7eed7e">Subscription</a></li>
<li><a href="#orgd1122bf">Account</a></li>
<li><a href="#org0f0b11b">Management Group</a></li>
<li><a href="#org1ea5b97">Storage Account</a></li>
<li><a href="#orgb0efc2e">Role</a></li>
<li><a href="#org395d05f">Resource</a></li>
<li><a href="#org9ac0bac">Application</a></li>
</ul>
</li>
<li><a href="#org10f98b1">IMDS</a></li>
<li><a href="#org319b043">VM</a>
<ul>
<li><a href="#orgc7251b3">List VM offers in region</a></li>
</ul>
</li>
<li><a href="#orgf0fcf24">VM Extensions</a></li>
<li><a href="#org3449473">API</a></li>
<li><a href="#org565b2cf">All Locations</a>
<ul>
<li><a href="#orge1e8f9f">List</a></li>
<li><a href="#org7d9e058">Loop</a></li>
</ul>
</li>
<li><a href="#org99ad6d7">Load Balancers</a>
<ul>
<li><a href="#org737b333">Create LB Rule</a></li>
<li><a href="#orgb61aa86">Create Load Balancer</a></li>
</ul>
</li>
<li><a href="#org497de1c">Providers</a>
<ul>
<li><a href="#orgca7c12a">All provides and registration state</a></li>
<li><a href="#org6f97dc3">Registerd namespaces</a></li>
</ul>
</li>
<li><a href="#org8557b59">Subscription Quotas</a></li>
<li><a href="#orgd2a5a7b">Create Public Static Ip</a></li>
<li><a href="#orga93c0d4">ACR</a>
<ul>
<li><a href="#orgfe73519">List registries</a></li>
<li><a href="#org55a09de">List repositories</a></li>
<li><a href="#orgbaea171">List repository versions</a></li>
</ul>
</li>
<li><a href="#org7ffad66">Api Versions</a>
<ul>
<li><a href="#org6746d52">Python</a></li>
</ul>
</li>
<li><a href="#orgb3b8951">Users</a>
<ul>
<li><a href="#org2320c28">Get My User</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-orged83908" class="outline-2">
<h2 id="orged83908"><a href="#orged83908">Managed Service Identities</a></h2>
<div class="outline-text-2" id="text-orged83908">
<p>
No need to have credentials or service principal.
</p>

<p>
Docs - Part of the Active Directory docs
<a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/">https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/</a>
</p>
</div>
</div>

<div id="outline-container-org4e21127" class="outline-2">
<h2 id="org4e21127"><a href="#org4e21127">Resource Providers</a></h2>
<div class="outline-text-2" id="text-org4e21127">
<p>
That is, "cloud services".
</p>

<p>
For example, there is a resource provider that provides virtual machines. It's
called Microsoft.Compute.
</p>

<p>
Every resource provider exposes a set of actions. That is, the service has an
API.
</p>
</div>
</div>

<div id="outline-container-org0f606c4" class="outline-2">
<h2 id="org0f606c4"><a href="#org0f606c4">RBAC</a></h2>
<div class="outline-text-2" id="text-org0f606c4">
<p>
Fine-grained control to the Azure "control plane".
</p>

<p>
When you assign a role to a certain scope, resources within that scope inherit
the role assignment.
</p>

<p>
A <b>Role</b> is a collection of actions (i.e. a collection of API operations). A
<b>Role Assignment</b> gives a <span class="underline">security principal</span> the ability to perform that set
of <span class="underline">actions</span> on that <span class="underline">scope</span>.
</p>

<p>
There are 3 top level roles in Azure:
</p>

<ol class="org-ol">
<li>Owner</li>
<li>Contributor</li>
<li>Reader</li>
</ol>
</div>

<div id="outline-container-org727a35f" class="outline-3">
<h3 id="org727a35f"><a href="#org727a35f">Security Principal</a></h3>
<div class="outline-text-3" id="text-org727a35f">
<ul class="org-ul">
<li>User</li>
<li>Group</li>
<li>Service Principal</li>
</ul>
</div>
</div>

<div id="outline-container-org5fa37e1" class="outline-3">
<h3 id="org5fa37e1"><a href="#org5fa37e1">Role</a></h3>
<div class="outline-text-3" id="text-org5fa37e1">
<ul class="org-ul">
<li>Built-in</li>
<li>Custom</li>
</ul>
</div>
</div>

<div id="outline-container-org1287e75" class="outline-3">
<h3 id="org1287e75"><a href="#org1287e75">Scope</a></h3>
<div class="outline-text-3" id="text-org1287e75">
<ul class="org-ul">
<li>Subscription</li>
<li>Resource Group</li>
<li>Resource</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org9686940" class="outline-2">
<h2 id="org9686940"><a href="#org9686940">Subscription Model</a></h2>
<div class="outline-text-2" id="text-org9686940">
<p>
Scope heirarchy:
Tenant -&gt; Management Group -&gt; Subscription -&gt; Resource Group -&gt; Resource
</p>
</div>

<div id="outline-container-org5eb49cd" class="outline-3">
<h3 id="org5eb49cd"><a href="#org5eb49cd">Tenant</a></h3>
<div class="outline-text-3" id="text-org5eb49cd">
<p>
Azure Active Directory entity that encompasses a whole organization. A tenant
has at least one subscription and user. You use it to manage subscriptions
and users in the organization.
</p>

<p>
This is kind of like an AWS Organization that is used to manage all the AWS
accounts in a company.
</p>
</div>
</div>

<div id="outline-container-org7f1b33c" class="outline-3">
<h3 id="org7f1b33c"><a href="#org7f1b33c">User</a></h3>
<div class="outline-text-3" id="text-org7f1b33c">
<p>
An individual and is associated with only one tenant, the organization that
they belong to. May have access to multiple subscriptions.
</p>

<p>
A user is a "User" in the Active Directory. That means users are tenant-level
entities. Each user can have multiple subscriptions.
</p>
</div>
</div>

<div id="outline-container-orgb7eed7e" class="outline-3">
<h3 id="orgb7eed7e"><a href="#orgb7eed7e">Subscription</a></h3>
<div class="outline-text-3" id="text-orgb7eed7e">
<p>
The agreements with Microsoft to use cloud services, including Azure.
</p>

<p>
Sometimes a "subscription" is referred to as an "account" i.e. "az account
set" command. I think a subscription is the most similar thing to an AWS
account.
</p>

<p>
The fact that Azure has resource groups adds a layer of isolation within
subscriptions that's harder to attain in AWS accounts, so in Azure you are
likely to have less subscriptions that you'd have accounts in AWS.
</p>
</div>
</div>

<div id="outline-container-orgd1122bf" class="outline-3">
<h3 id="orgd1122bf"><a href="#orgd1122bf">Account</a></h3>
<div class="outline-text-3" id="text-orgd1122bf">
<p>
Can mean a few things:
</p>

<ol class="org-ol">
<li>The Microsoft Account that was used when signing up for Azure. A Microsoft
Account is the account you use to access Office 365, XBox Live, etc.

<ul class="org-ul">
<li>When you sign up for an Azure subscription with a personal Microsoft
Account, an Azure AD Tenant is created for you.</li>

<li>Or, you can create an Azure subscription associated with an existing
Azure AD Tenant.</li>
</ul></li>

<li>An Azure subscription. This is what `azure account list` and `azure account
set` do</li>

<li>A Service Principal, which is sometimes referred to as using a "service
account". "Service principals are accounts not tied to any particular user" -
<a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest#sign-in-with-a-service-principal">https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli?view=azure-cli-latest#sign-in-with-a-service-principal</a></li>
</ol>
</div>
</div>

<div id="outline-container-org0f0b11b" class="outline-3">
<h3 id="org0f0b11b"><a href="#org0f0b11b">Management Group</a></h3>
<div class="outline-text-3" id="text-org0f0b11b">
<p>
A level of management above subscriptions (but still within a single
tenant). Management Groups allow you to associate certain settings with many
subscriptions.
</p>
</div>
</div>

<div id="outline-container-org1ea5b97" class="outline-3">
<h3 id="org1ea5b97"><a href="#org1ea5b97">Storage Account</a></h3>
<div class="outline-text-3" id="text-org1ea5b97">
<p>
How is this different from account or resource group?
</p>
</div>
</div>

<div id="outline-container-orgb0efc2e" class="outline-3">
<h3 id="orgb0efc2e"><a href="#orgb0efc2e">Role</a></h3>
<div class="outline-text-3" id="text-orgb0efc2e">
<p>
Controls access to resources. Can be assigned to users, groups, or services.
</p>
</div>
</div>

<div id="outline-container-org395d05f" class="outline-3">
<h3 id="org395d05f"><a href="#org395d05f">Resource</a></h3>
<div class="outline-text-3" id="text-org395d05f">
<p>
Associated with a subscription
</p>
</div>
</div>

<div id="outline-container-org9ac0bac" class="outline-3">
<h3 id="org9ac0bac"><a href="#org9ac0bac">Application</a></h3>
<div class="outline-text-3" id="text-org9ac0bac">
<p>
Something in Azure that outsources authentication to Azure AD. AD uses Oauth
2.0 to authenticate to the application, which mean the application must have
a URL.
</p>

<p>
Sometimes "Application" refers to the entity requesting an auth token in an
Oauth2 authentication flow. I think OAuth2 refers to this entity as the
"client application". See:
<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/developer-glossary#client-application">https://docs.microsoft.com/en-us/azure/active-directory/develop/developer-glossary#client-application</a>
</p>

<p>
Sometimes "Application" refers to a VM. For example when adding an access
policy to keyvault; if you add a VM, it is labelled as an "application". In
this case I suppose "application" refers to "code on the VM that needs
keyvault creds".
</p>
</div>
</div>
</div>

<div id="outline-container-org10f98b1" class="outline-2">
<h2 id="org10f98b1"><a href="#org10f98b1">IMDS</a></h2>
<div class="outline-text-2" id="text-org10f98b1">
<p>
Available to all vms created with ARM.
</p>

<p>
Get Token
</p>
<div class="org-src-container">
<pre class="src src-sh">curl -H Metadata:true <span style="color: #98be65;">\</span>
     <span style="color: #98be65;">"http://169.254.169.254/metadata/identity/oauth2/token?resource=https://management.azure.com&amp;api-version=2018-04-02"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org319b043" class="outline-2">
<h2 id="org319b043"><a href="#org319b043">VM</a></h2>
<div class="outline-text-2" id="text-org319b043">
</div>
<div id="outline-container-orgc7251b3" class="outline-3">
<h3 id="orgc7251b3"><a href="#orgc7251b3">List VM offers in region</a></h3>
<div class="outline-text-3" id="text-orgc7251b3">
<div class="org-src-container">
<pre class="src src-sh">az vm image list --all -l eastus
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf0fcf24" class="outline-2">
<h2 id="orgf0fcf24"><a href="#orgf0fcf24">VM Extensions</a></h2>
<div class="outline-text-2" id="text-orgf0fcf24">
<p>
VM Extensions are run using a vm agent. The agent is installed by default in
Azure Marketplace images.
</p>
</div>
</div>

<div id="outline-container-org3449473" class="outline-2">
<h2 id="org3449473"><a href="#org3449473">API</a></h2>
<div class="outline-text-2" id="text-org3449473">
<p>
List vms
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">r</span>=$(curl -H Metadata:true <span style="color: #98be65;">"http://169.254.169.254/metadata/identity/oauth2/token?resource=https://management.azure.com&amp;api-version=2018-04-02"</span>)
<span style="color: #dcaeea;">access_token</span>=$(<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">r</span> | jq -r <span style="color: #98be65;">'.access_token'</span>)
<span style="color: #dcaeea;">url</span>=<span style="color: #98be65;">"https://management.azure.com/subscriptions/10f9b671-4896-4336-ba3d-82e9d4ab0b52/providers/Microsoft.Compute/virtualMachines?api-version=2018-06-01"</span>
curl $<span style="color: #dcaeea;">url</span> -H <span style="color: #98be65;">"Authorization: Bearer $access_token"</span> | jq
</pre>
</div>
</div>
</div>

<div id="outline-container-org565b2cf" class="outline-2">
<h2 id="org565b2cf"><a href="#org565b2cf">All Locations</a></h2>
<div class="outline-text-2" id="text-org565b2cf">
</div>
<div id="outline-container-orge1e8f9f" class="outline-3">
<h3 id="orge1e8f9f"><a href="#orge1e8f9f">List</a></h3>
<div class="outline-text-3" id="text-orge1e8f9f">
<div class="org-src-container">
<pre class="src src-sh">az account list-locations --query <span style="color: #98be65;">"[].name"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d9e058" class="outline-3">
<h3 id="org7d9e058"><a href="#org7d9e058">Loop</a></h3>
<div class="outline-text-3" id="text-org7d9e058">
<p>
Create a Public IP in each location
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">locations</span>=($(az account list-locations | jq -r <span style="color: #98be65;">'.[].name'</span>))
<span style="color: #51afef;">for</span> i<span style="color: #51afef;"> in</span> <span style="color: #98be65;">"${!locations[@]}"</span>; <span style="color: #51afef;">do</span>
    <span style="color: #dcaeea;">location</span>=${<span style="color: #dcaeea;">locations</span>[$<span style="color: #dcaeea;">i</span>]}
    <span style="color: #c678dd;">echo</span> ip-$<span style="color: #dcaeea;">i</span> $<span style="color: #dcaeea;">$location</span>
    az network public-ip create <span style="color: #98be65;">\</span>
       -g PublicIpPool <span style="color: #98be65;">\</span>
       -n ip-$<span style="color: #dcaeea;">i</span> <span style="color: #98be65;">\</span>
       --allocation-method Static
<span style="color: #51afef;">done</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org99ad6d7" class="outline-2">
<h2 id="org99ad6d7"><a href="#org99ad6d7">Load Balancers</a></h2>
<div class="outline-text-2" id="text-org99ad6d7">
</div>
<div id="outline-container-org737b333" class="outline-3">
<h3 id="org737b333"><a href="#org737b333">Create LB Rule</a></h3>
<div class="outline-text-3" id="text-org737b333">
<div class="org-src-container">
<pre class="src src-sh">az network lb rule create -g $<span style="color: #dcaeea;">CLUSTER_NAME</span> <span style="color: #98be65;">\</span>
   --lb-name fixed-ip-lb <span style="color: #98be65;">\</span>
   -n fixed-ip-ssh-rule <span style="color: #98be65;">\</span>
   --protocol Tcp <span style="color: #98be65;">\</span>
   --frontend-port 443 <span style="color: #98be65;">\</span>
   --backend-pool-name fixed-ip-lbbepool <span style="color: #98be65;">\</span>
   --backend-port 443
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb61aa86" class="outline-3">
<h3 id="orgb61aa86"><a href="#orgb61aa86">Create Load Balancer</a></h3>
<div class="outline-text-3" id="text-orgb61aa86">
<div class="org-src-container">
<pre class="src src-sh">az network lb create <span style="color: #98be65;">\</span>
   -n mylb <span style="color: #98be65;">\</span>
   -g $<span style="color: #dcaeea;">ResourceGroup</span> <span style="color: #98be65;">\</span>
   -l westus2 <span style="color: #98be65;">\</span>
   --public-ip-address <span style="color: #98be65;">"/subscriptions/$SUBSCRIPTION_ID/resourceGroups/PublicIpPool/providers/Microsoft.Network/publicIPAddresses/$IP_NAME"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org497de1c" class="outline-2">
<h2 id="org497de1c"><a href="#org497de1c">Providers</a></h2>
<div class="outline-text-2" id="text-org497de1c">
</div>
<div id="outline-container-orgca7c12a" class="outline-3">
<h3 id="orgca7c12a"><a href="#orgca7c12a">All provides and registration state</a></h3>
<div class="outline-text-3" id="text-orgca7c12a">
<p>
az provider list &#x2013;query "[].{Provider:namespace, Status:registrationState}"
&#x2013;out table
</p>
</div>
</div>

<div id="outline-container-org6f97dc3" class="outline-3">
<h3 id="org6f97dc3"><a href="#org6f97dc3">Registerd namespaces</a></h3>
<div class="outline-text-3" id="text-org6f97dc3">
<p>
az provider list &#x2013;query "[?registrationState == 'Registered'].namespace"
&#x2013;out table
</p>
</div>
</div>
</div>

<div id="outline-container-org8557b59" class="outline-2">
<h2 id="org8557b59"><a href="#org8557b59">Subscription Quotas</a></h2>
<div class="outline-text-2" id="text-org8557b59">
<div class="org-src-container">
<pre class="src src-fish"><span style="color: #51afef;">function</span> <span style="color: #c678dd;">getLimit</span> <span style="color: #51afef; font-weight: bold;">--description</span> <span style="color: #98be65;">"Get a quota limit in the given region"</span>
    <span style="color: #51afef;">set</span> <span style="color: #dcaeea;">location</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">argv</span>[<span style="color: #a9a1e1;">1</span>]
    <span style="color: #51afef;">set</span> <span style="color: #dcaeea;">limit</span> (az vm list-usage <span style="color: #51afef; font-weight: bold;">\</span>
        <span style="color: #c678dd;">--location</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">location</span> <span style="color: #51afef; font-weight: bold;">\</span>
        <span style="color: #c678dd;">-o</span> json <span style="color: #51afef; font-weight: bold;">\</span>
        <span style="color: #51afef; font-weight: bold;">|</span> jq -r <span style="color: #98be65;">'.[] | select(.localName == "Total Regional vCPUs") | .limit'</span>)
    <span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"$location: $limit"</span>
<span style="color: #51afef;">end</span>

<span style="color: #51afef;">function</span> <span style="color: #c678dd;">getAllLimits</span> <span style="color: #51afef; font-weight: bold;">--description</span> <span style="color: #98be65;">"Get all Total Region vCPU limits"</span>
    <span style="color: #51afef;">set</span> <span style="color: #dcaeea;">locations</span> (<span style="color: #c678dd;">az</span> account list-locations <span style="color: #51afef; font-weight: bold;">|</span> <span style="color: #c678dd;">jq</span> -r <span style="color: #98be65;">'.[].name'</span>)
    <span style="color: #c678dd;">echo</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">locations</span> <span style="color: #51afef; font-weight: bold;">|</span> <span style="color: #c678dd;">xargs</span> -n <span style="color: #a9a1e1;">1</span> -P (<span style="color: #c678dd;">count</span> <span style="color: #98be65;">$</span><span style="color: #dcaeea;">locations</span>) -I {} <span style="color: #c678dd;">fish</span> -c <span style="color: #98be65;">'getLimit {}'</span>
<span style="color: #51afef;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">allLocations</span>=$(az account list-locations | jq -r <span style="color: #98be65;">'.[].name'</span>)

<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">allLocations</span> | xargs
<span style="color: #51afef;">for</span> location<span style="color: #51afef;"> in</span> ; <span style="color: #51afef;">do</span>
    <span style="color: #dcaeea;">limit</span>=$(az vm list-usage <span style="color: #98be65;">\</span>
               --location $<span style="color: #dcaeea;">location</span> <span style="color: #98be65;">\</span>
               -o json <span style="color: #98be65;">\</span>
                | jq -r <span style="color: #98be65;">'.[] | select(.localName == "Total Regional vCPUs") | .limit'</span>)
    <span style="color: #c678dd;">echo</span> <span style="color: #98be65;">"$location: $limit"</span>
<span style="color: #51afef;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2a5a7b" class="outline-2">
<h2 id="orgd2a5a7b"><a href="#orgd2a5a7b">Create Public Static Ip</a></h2>
<div class="outline-text-2" id="text-orgd2a5a7b">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">location</span>=<span style="color: #98be65;">"westus2"</span>
az network public-ip create <span style="color: #98be65;">\</span>
   -g PublicIpPool <span style="color: #98be65;">\</span>
   -n ip-$<span style="color: #dcaeea;">location</span>-1 <span style="color: #98be65;">\</span>
   -l $<span style="color: #dcaeea;">location</span> <span style="color: #98be65;">\</span>
   --allocation-method Static
</pre>
</div>
</div>
</div>

<div id="outline-container-orga93c0d4" class="outline-2">
<h2 id="orga93c0d4"><a href="#orga93c0d4">ACR</a></h2>
<div class="outline-text-2" id="text-orga93c0d4">
</div>
<div id="outline-container-orgfe73519" class="outline-3">
<h3 id="orgfe73519"><a href="#orgfe73519">List registries</a></h3>
<div class="outline-text-3" id="text-orgfe73519">
<div class="org-src-container">
<pre class="src src-sh">az acr list | jq -c <span style="color: #98be65;">'.[] | {name, loginServer, location}'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org55a09de" class="outline-3">
<h3 id="org55a09de"><a href="#org55a09de">List repositories</a></h3>
<div class="outline-text-3" id="text-org55a09de">
<div class="org-src-container">
<pre class="src src-sh">az acr repository list -n $<span style="color: #dcaeea;">name</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbaea171" class="outline-3">
<h3 id="orgbaea171"><a href="#orgbaea171">List repository versions</a></h3>
<div class="outline-text-3" id="text-orgbaea171">
<div class="org-src-container">
<pre class="src src-sh">az acr repository show-manifests <span style="color: #98be65;">\</span>
   -n $<span style="color: #dcaeea;">name</span> <span style="color: #98be65;">\</span>
   --repository quay.io/kubernetes-ingress-controller/nginx-ingress-controller
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7ffad66" class="outline-2">
<h2 id="org7ffad66"><a href="#org7ffad66">Api Versions</a></h2>
<div class="outline-text-2" id="text-org7ffad66">
<p>
Get the latest Api Version for something
</p>

<div class="org-src-container">
<pre class="src src-sh">az provider list --query <span style="color: #98be65;">"[?namespace=='Microsoft.ClassicNetwork']"</span> &gt; ~/cats/resource_provider.json
jq <span style="color: #98be65;">'.[].resourceTypes[] | select(.resourceType == "reservedIps").apiVersions | first'</span> &lt;~/cats/resource_provider.json
</pre>
</div>
</div>

<div id="outline-container-org6746d52" class="outline-3">
<h3 id="org6746d52"><a href="#org6746d52">Python</a></h3>
<div class="outline-text-3" id="text-org6746d52">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">from</span> msrestazure.tools <span style="color: #51afef;">import</span> parse_resource_id

<span style="color: #51afef;">def</span> <span style="color: #c678dd;">_get_ip_address</span>(<span style="color: #51afef;">self</span>, resource_id: <span style="color: #c678dd;">str</span>) -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Determine the latest API version for this resource type</span>
    parsed_id = parse_resource_id(resource_id)
    <span style="color: #dcaeea;">provider</span> = <span style="color: #51afef;">self</span>.resource_client.providers.get(parsed_id[<span style="color: #98be65;">"namespace"</span>])
    <span style="color: #dcaeea;">resource_type_def</span> = <span style="color: #c678dd;">next</span>(
        i
        <span style="color: #51afef;">for</span> i <span style="color: #51afef;">in</span> provider.resource_types
        <span style="color: #51afef;">if</span> i.resource_type.lower() == parsed_id[<span style="color: #98be65;">"resource_type"</span>].lower()
    )

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Supported API versions are ordered from newest to oldest</span>
    <span style="color: #dcaeea;">api_version</span> = resource_type_def.api_versions[0]

    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Fetch the IP resource and return its IP address</span>
    <span style="color: #dcaeea;">resource</span> = <span style="color: #51afef;">self</span>.resource_client.resources.get_by_id(resource_id, api_version)
    <span style="color: #51afef;">return</span> resource.properties[<span style="color: #98be65;">"ipAddress"</span>]
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb3b8951" class="outline-2">
<h2 id="orgb3b8951"><a href="#orgb3b8951">Users</a></h2>
<div class="outline-text-2" id="text-orgb3b8951">
</div>
<div id="outline-container-org2320c28" class="outline-3">
<h3 id="org2320c28"><a href="#org2320c28">Get My User</a></h3>
<div class="outline-text-3" id="text-org2320c28">
<div class="org-src-container">
<pre class="src src-sh">az ad user list --query <span style="color: #98be65;">"[?mailNickname=='chris.clark']"</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
